<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Flight Data" />
    <meta name="author" content="Your Name" />
    <title>Flight Data</title>
    <link rel="icon" href="{{ url_for('static', filename='images/ea.jpg') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
     <!-- Include jQuery (for Bootstrap 4) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet"> <!-- Roboto font -->
    <style>
       /* Simula dito yung style  pababa*/
   body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f8fc;
            margin: 0;
            padding: 0;
        }

        .table-wrapper {
            margin: 30px;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h1 {
            font-size: 20px;
            color: #333;
            font-weight: 500;
        }

        .table-header .actions {
            display: flex;
            gap: 10px;
        }

        .table-header .actions button {
            border: none;
            padding: 10px 15px;
            background-color: #003c57;
            color: #fff;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .table-header .actions button:hover {
            background-color: #00587a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 10px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        th {
            background: linear-gradient(180deg, #f5b3b3, #f77d7d, #f5756c, #c62828); /* Bold red gradient */
            color: #FFFFFF; /* White text for contrast */
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            padding: 10px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        th:hover {
            background: linear-gradient(180deg, #f89f9f, #f85e5e, #e53935, #b71c1c); /* Slightly darker red tones on hover */
            color: #080404; /* Maintain contrast */
            cursor: pointer;
        }

        th:first-child {
            border-top-left-radius: 8px;
        }

        th:last-child {
            border-top-right-radius: 8px;
        }

        td {
            font-size: 10px;
            color: #333;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #eef5f9;
        }

        .actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .delete-btn {
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s ease;
        }

        .delete-btn i {
            font-size: 18px;
            color: #f44336; /* Vibrant red for the default state */
            transition: color 0.3s ease; /* Smooth transition for hover effect */
        }

        .delete-btn:hover {
            transform: scale(1.1);  /* Slight scale on hover for better interaction feedback */
        }

        .delete-btn i:hover {
            color: #c62828; /* Deep red on hover for a bold effect */
        }
        
     #yearFilter, #quarterFilter, #monthFilter {
     margin: 10px 0; /* Adds top and bottom margin */
      }

     body {
         font-family: 'Roboto', sans-serif;
         height: 100vh;
         display: flex;
         flex-direction: column;
     }

     .header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         background-color: #e0e0e0;
         padding-top: 10px;
         padding-bottom: 10px;
         border-bottom: 2px solid #ccc;
         z-index: 1;
         position: relative;
     }

     .header .logo {
         width: 50px;
         height: auto;
         margin-left: 100px;
         transition: margin-left 0.5s ease;
     }

     .header .logo.csd {
         margin-left: 20px;
     }

     .header .title {
         font-size: 28px;
         font-weight: bold;
         color: #333;
         text-align: center;
         flex-grow: 1;
     }

     .content {
         flex-grow: 1;
         background-color: #d50000;
         padding: 40px;
         display: flex;
         justify-content: center;
         align-items: center;
         transition: margin-left 0.5s ease;
     }

     .filter-container {
         margin-bottom: 20px;
     }

     .filter-container select {
         padding: 10px;
         font-size: 16px;
     }

     #reportTable {
         width: 100%;
         border-collapse: collapse;
     }

     #reportTable th, #reportTable td {
         padding: 10px;
         border: 1px solid #000;
     }
         .modal {
 display: none; /* Flexbox to center content */
 justify-content: center; /* Center horizontally */
 align-items: flex-start; /* Align content at the top */
 position: fixed; /* Stay in place */
 z-index: 2; /* Sit above everything */
 left: 0;
 top: 0;
 width: 100%; /* Full width */
 height: 100%; /* Full height */
 background-color: rgba(0, 0, 0, 0.5); /* Black background with opacity */
 padding-top: 50px; /* Adjust padding to move content lower */
}

.modal-content {
    background-color: #fefefe;
    margin: 2% auto;
    padding: 10px; /* Reduced padding */
    width: 40%; /* Set a smaller width */
    max-width: 500px; /* Maximum width for larger screens */
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.close {
 color: #aaa;
 float: right;
 font-size: 28px;
 font-weight: bold;
}

.close:hover,
.close:focus {
 color: #000;
 text-decoration: none;
 cursor: pointer;
}

/* start modal */
.container {
    background: #f44336; /* Solid red color matching the delete icon */
    padding: 15px;
    width: 100%;
    border-radius: 10px;
    color: #ffffff; /* White text for readability */
    display: flex;
    justify-content: space-between;
    align-items: center; /* Align content vertically */
    box-sizing: border-box;
    transition: background 0.3s ease; /* Smooth transition for hover effect */
}

.container:hover {
    background: #e53935; /* Slightly darker red for hover */
}
/* end */

.form-container {
    width: 100%; /* Full width to remove extra space */
    margin: 0;
}

.form-container form {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.form-container form label {
 font-size: 14px; /* Smaller font size for labels */
 margin-bottom: 5px; /* Minimal space between label and input */
}

.form-container form input,
.form-container form select {
 padding: 8px; /* Reduced padding inside input fields */
 border: 1px solid #ccc;
 border-radius: 5px;
 background-color: #f9f9f9;
 color: #333;
 font-size: 14px; /* Smaller font size for inputs */
}

.form-container form button {
 padding: 10px; /* Smaller button padding */
 background-color: #666;
 color: #fff;
 border: none;
 border-radius: 5px;
 cursor: pointer;
 font-size: 14px; /* Smaller font size for buttons */
}

.form-container form button:hover {
 background-color: #555;
}

.result-container {
 background-color: #e0e0e0;
 padding: 15px; /* Smaller padding for result container */
 border-radius: 10px;
}

#result {
 background-color: #fff;
 color: #333;
 padding: 15px; /* Reduced padding */
 border-radius: 10px;
 margin-top: 15px;
}

canvas {
 margin-top: 20px;
 display: block;
 width: 100%;
}

.buttons-container {
 display: flex;
 justify-content: center;
 gap: 10px; /* Reduced gap between buttons */
 margin-top: 20px;
}

button {
 padding: 10px 15px; /* Reduced button padding */
 font-size: 14px; /* Smaller button font size */
 border: none;
 border-radius: 5px;
 cursor: pointer;
 transition: background-color 0.3s ease;
 margin-left: 10px; /* Adds space to move the button to the right */
}

/* start button */
button.btn-primary {
    background-color: #f44336; /* Matching red background color */
    color: #fff; /* White text for readability */
    border: none; /* Remove default border */
    padding: 10px 20px; /* Adjust padding for a better button appearance */
    border-radius: 5px; /* Rounded corners */
    font-size: 16px; /* Font size for the button */
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

button.btn-primary:hover {
    background-color: #e53935; /* Slightly darker red for hover effect */
}
/* end*/

button:first-child {
 background-color: #666;
 color: white;
}

button:first-child:hover {
 background-color: #555;
}

button:last-child {
 background-color: #ffffff;
 border: 1px solid #c23b3b !important;
 color: rgb(0, 0, 0);
}

button:last-child:hover {
 background-color: #d50000;
}

.pagination-container {
 margin-top: 20px; /* Add some margin above the pagination */
 text-align: center;
}

.pagination .page-item .page-link {
 color: black; /* Set font color to black */
}

.pagination .page-item.active .page-link {
 background-color: #f44336; /* Active page with the same red color */
 border-color: #f44336;
 color: white; /* White text for the active page */
}

.pagination .page-link:hover {
 background-color: #f44336; /* Darker red on hover */
 color: white; /* White text on hover */
}

.delete-button {
        background-color: #d50000; /* Red background */
        color: white; /* White text */
        border: none; /* Remove border */
        border-radius: 5px; /* Rounded corners */
        padding: 5px 10px; /* Adjust padding for size */
        font-size: 14px; /* Adjust font size */
        cursor: pointer; /* Pointer on hover */
    }

    .delete-button:hover {
        background-color: #b71c1c; /* Darker red on hover */
    }

     .delete-icon {
         cursor: pointer;
         color: #fd0808;
     }

     @media screen and (max-width: 768px) {
 table {
     font-size: 10px; /* Adjusted font size for smaller screens */
 }

 th, td {
     padding: 6px; /* Adjusted padding for smaller screens */
 }

 .modal-content {
     width: 90%; /* Modal width adjusts to smaller screens */
 }

 .form-container,
 .result-container {
     width: 100%; /* Stack form and result container on smaller screens */
 }

 .container {
     padding: 10px; /* Adjust padding for smaller screens */
 }
}
.sb-topnav .navbar-nav .nav-item .nav-link {
    display: flex;
    align-items: center;
    padding: 0 10px; /* Adjust as needed */
    color: white;
}

.sb-topnav .navbar-nav .nav-item .nav-link i {
    margin-right: 5px; /* Space between icon and text */
}
 </style>
</head>
<body class="sb-nav-fixed">
    <!-- Navbar -->
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="{{ url_for('external_dashboard') }}">EXTERNAL AFFAIRS <span style="text-transform: uppercase; font-style: italic;">{{ session['campus'] }} CAMPUS</span></a>

        <!-- Sign-out -->
        <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-power-off fa-fw"></i> Sign-out
                </a>
            </li>
        </ul>
    </nav>

    <div id="layoutSidenav" style="display: flex; height: 100vh;">
        <div id="layoutSidenav_nav" style="flex: 0 0 250px; overflow-y: auto;">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{{ url_for('external_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <div class="sb-sidenav-menu-heading">Consumption</div>
                        <nav class="sb-sidenav-menu-nested nav">
                        <a class="nav-link" href="{{ url_for('flight') }}">Flight</a>
                        <a class="nav-link" href="{{ url_for('accommodation') }}">Accommodation</a>
                        </nav>
                    </div>
                </div>
            </nav>
        </div>

        
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <!-- Page Header -->
                    <h1 class="mt-4">Flight Data</h1>
                    <ol class="breadcrumb mb-4">
                        <li class="breadcrumb-item"><a href="{{ url_for('procurement_dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item active">Flight Data</li>
                    </ol>

                    <!-- Info Card -->
                    <div class="card mb-4">
                        <div class="card-body">
                            Flight data emissions contribute significantly to the overall carbon footprint through fuel consumption.
                        </div>
                    </div>

                    <div id="FlightSection">
                        <div>
                            <button id="openModalBtn" class="btn btn-primary" style="background-color: #f44336;" onclick="openCalculatorModal()">Calculate</button>
                            <button class="btn btn-primary" onclick="printReport()">Print Report</button>
                            <button class="btn btn-primary" onclick="downloadExcel()">Download Excel</button>
                            <button class="btn btn-primary" onclick="downloadCSV()">Download CSV</button>
                        </div>
    
                        <div class="mb-4">
                            <label for="yearFilter">Filter by Year:</label>
                            <select id="yearFilter" onchange="filterByYear()">
                                <option value="">All Years</option>
                            <option value="2014" {% if selected_year == "2014" %}selected{% endif %}>2014</option>
                            <option value="2015" {% if selected_year == "2015" %}selected{% endif %}>2015</option>
                            <option value="2016" {% if selected_year == "2016" %}selected{% endif %}>2016</option>
                            <option value="2017" {% if selected_year == "2017" %}selected{% endif %}>2017</option>
                            <option value="2018" {% if selected_year == "2018" %}selected{% endif %}>2018</option>
                            <option value="2019" {% if selected_year == "2019" %}selected{% endif %}>2014</option>
                            <option value="2020" {% if selected_year == "2020" %}selected{% endif %}>2020</option>
                            <option value="2021" {% if selected_year == "2021" %}selected{% endif %}>2021</option>
                            <option value="2022" {% if selected_year == "2022" %}selected{% endif %}>2022</option>
                            <option value="2023" {% if selected_year == "2023" %}selected{% endif %}>2023</option>
                            <option value="2024" {% if selected_year == "2024" %}selected{% endif %}>2024</option>
                            </select>
                        </div>
                    
                <div class="table-responsive mt-4">
                    <div class="table-wrapper">
                        <table id="reportTable" class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Office</th>
                                <th>Traveller</th>
                                <th>Purpose</th>
                                <th>Travel Date</th>
                                <th>Flight Type</th>
                                <th>Origin</th>
                                <th>Destination</th>
                                <th>Class</th>
                                <th>One Way/Round Trip</th>
                                <th>kg CO₂e</th>
                                <th>t CO₂e</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for flight in flight_data %}
                            <tr data-id="{{ flight.ID }}"> <!-- Use `ID` here -->
                                <td>{{ flight.Year }}</td>
                                <td>{{ flight.Office }}</td>
                                <td>{{ flight.TravellerName }}</td>
                                <td>{{ flight.TravelPurpose }}</td>
                                <td>{{ flight.TravelDate }}</td>
                                <td>{{ flight.DomesticInternational }}</td>
                                <td>{{ flight.Origin }}</td>
                                <td>{{ flight.Destination }}</td>
                                <td>{{ flight.Class }}</td>
                                <td>{{ flight.OnewayRoundTrip }}</td>
                                <td>{{ flight.GHGEmissionKGC02e }}</td>
                                <td>{{ flight.GHGEmissionTC02e }}</td>
                                <td>
                                   <button class="delete-btn" onclick="deleteFlight({{ record.id }})"><i class="fa-solid fa-trash"></i></button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </div>
                </div>
                    </table>

                     <!-- Pagination controls -->
                     <div class="pagination-container">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                {% if total_pages > 1 %}
                                    <!-- Previous button -->
                                    <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                                        <a class="page-link" href="{{ url_for('flight', page=current_page - 1) }}" tabindex="-1">Previous</a>
                                    </li>
                                    
                                    <!-- Page numbers -->
                                    <span>Page {{ current_page }} of {{ total_pages }}</span>
                                    
                                    <!-- Next button -->
                                    <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                                        <a class="page-link" href="{{ url_for('flight', page=current_page + 1) }}">Next</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for Flight Data Entry -->
   <!-- Modal for Flight Data Entry -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="container form-container"> <!-- Use form-container directly inside container -->
            <form method="POST" action="{{ url_for('flight') }}" id="flightForm">
                <label for="campus">Campus:</label>
                <select id="campus" name="campus" disabled>
                    <option value="" {% if not session.get('campus') %}selected{% endif %}></option>
                    <option value="Alangilan" {% if session.get('campus') == 'Alangilan' %}selected{% endif %}>Alangilan</option>
                    <option value="ARASOF-Nasugbu" {% if session.get('campus') == 'ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                    <option value="Balayan" {% if session.get('campus') == 'Balayan' %}selected{% endif %}>Balayan</option>
                    <option value="Central" {% if session.get('campus') == 'Central' %}selected{% endif %}>Central</option>
                    <option value="JPLPC-Malvar" {% if session.get('campus') == 'JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                    <option value="Lemery" {% if session.get('campus') == 'Lemery' %}selected{% endif %}>Lemery</option>
                    <option value="Lipa" {% if session.get('campus') == 'Lipa' %}selected{% endif %}>Lipa</option>
                    <option value="Lobo" {% if session.get('campus') == 'Lobo' %}selected{% endif %}>Lobo</option>
                    <option value="Mabini" {% if session.get('campus') == 'Mabini' %}selected{% endif %}>Mabini</option>
                    <option value="Pablo Borbon" {% if session.get('campus') == 'Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                    <option value="Rosario" {% if session.get('campus') == 'Rosario' %}selected{% endif %}>Rosario</option>
                    <option value="San Juan" {% if session.get('campus') == 'San Juan' %}selected{% endif %}>San Juan</option>
                </select>
                

                <label for="office">Office/Department:</label>
                <select id="office" name="office" required>
                    <option value=""></option>
                    <option value="IAU" {% if office == 'IAU' %}selected{% endif %}>IAU</option>
                    <option value="QAM" {% if office == 'QAM' %}selected{% endif %}>QAM</option>
                    <option value="SDO" {% if office == 'SDO' %}selected{% endif %}>SDO</option>
                    <option value="PDO" {% if office == 'PDO' %}selected{% endif %}>PDO</option>
                    <option value="EA" {% if office == 'EA' %}selected{% endif %}>EA</option>
                    <option value="RGO" {% if office == 'RGO' %}selected{% endif %}>RGO</option>
                    <option value="ICT" {% if office == 'ICT' %}selected{% endif %}>ICT</option>
                    <option value="CAS" {% if office == 'CAS' %}selected{% endif %}>CAS</option>
                    <option value="CABE" {% if office == 'CABE' %}selected{% endif %}>CABE</option>
                    <option value="CICS" {% if office == 'CICS' %}selected{% endif %}>CICS</option>
                    <option value="CET" {% if office == 'CET' %}selected{% endif %}>CET</option>
                    <option value="CTE" {% if office == 'CTE' %}selected{% endif %}>CTE</option>
                    <option value="CE" {% if office == 'CE' %}selected{% endif %}>CE</option>
                    <option value="CA" {% if office == 'CA' %}selected{% endif %}>CA</option>
                    <option value="TAO" {% if office == 'TAO' %}selected{% endif %}>TAO</option>
                    <option value="ORS" {% if office == 'ORS' %}selected{% endif %}>ORS</option>
                    <option value="SFAO" {% if office == 'SFAO' %}selected{% endif %}>SFAO</option>
                    <option value="GC" {% if office == 'GC' %}selected{% endif %}>GC</option>
                    <option value="OLS" {% if office == 'OLS' %}selected{% endif %}>OLS</option>
                    <option value="SOO" {% if office == 'SOO' %}selected{% endif %}>SOO</option>
                    <option value="SD" {% if office == 'SD' %}selected{% endif %}>SD</option>
                    <option value="OJT" {% if office == 'OJT' %}selected{% endif %}>OJT</option>
                    <option value="NSTP" {% if office == 'NSTP' %}selected{% endif %}>NSTP</option>
                    <option value="HRMO" {% if office == 'HRMO' %}selected{% endif %}>HRMO</option>
                    <option value="RMO" {% if office == 'RMO' %}selected{% endif %}>RMO</option>
                    <option value="PO" {% if office == 'PO' %}selected{% endif %}>PO</option>
                    <option value="BO" {% if office == 'BO' %}selected{% endif %}>BO</option>
                    <option value="CD" {% if office == 'CD' %}selected{% endif %}>CD</option>
                    <option value="AO" {% if office == 'AO' %}selected{% endif %}>AO</option>
                    <option value="PFMO" {% if office == 'PFMO' %}selected{% endif %}>PFMO</option>
                    <option value="EMU" {% if office == 'EMU' %}selected{% endif %}>EMU</option>
                    <option value="PSO" {% if office == 'PSO' %}selected{% endif %}>PSO</option>
                    <option value="GSO" {% if office == 'GSO' %}selected{% endif %}>GSO</option>
                    <option value="ESO" {% if office == 'ESO' %}selected{% endif %}>ESO</option>
                    <option value="RO" {% if office == 'RO' %}selected{% endif %}>RO</option>
                    <option value="OVCRDES" {% if office == 'OVCRDES' %}selected{% endif %}>OVCRDES</option>
                    <option value="OVCDEA" {% if office == 'OVCDEA' %}selected{% endif %}>OVCDEA</option>
                    <option value="OVCAA" {% if office == 'OVCAA' %}selected{% endif %}>OVCAA</option>
                    <option value="OVCAF" {% if office == 'OVCAF' %}selected{% endif %}>OVCAF</option>
                </select>

                <label for="year">Year:</label>
                <select id="year" name="year" required>
                    <option value=""></option>
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                </select>

                <label for="travellerName">Name of Traveller:</label>
                <input type="text" id="travellerName" name="travellerName" required>

                <label for="travelPurpose">Purpose of Travel:</label>
                <input type="text" id="travelPurpose" name="travelPurpose" required>

                <label for="travelDate">Travel Date:</label>
                <input type="date" id="travelDate" name="travelDate" required>

                <label for="domesticInternational">Domestic/International:</label>
                <select id="domesticInternational" name="domesticInternational" required>
                    <option value=""></option>
                    <option value="Domestic">Domestic</option>
                    <option value="International">International</option>
                </select>

                <label for="origin">Origin (City or IATA Code):</label>
                <input type="text" id="origin" name="origin" required>

                <label for="destination">Destination (City or IATA Code):</label>
                <input type="text" id="destination" name="destination" required>

                <label for="class">Class:</label>
                <select id="class" name="class" required>
                    <option value=""></option>
                    <option value="Economy">Economy</option>
                    <option value="Business Class">Business Class</option>
                </select>

                <label for="onewayRoundTrip">One Way/Round Trip:</label>
                <select id="onewayRoundTrip" name="onewayRoundTrip" required>
                    <option value=""></option>
                    <option value="One Way">One Way</option>
                    <option value="Round Trip">Round Trip</option>
                </select>

                <label for="ghgEmissionKGC02e">kg CO2e:</label>
                <input type="text" id="ghgEmissionKGC02e" name="ghgEmissionKGC02e" required>

                <label for="ghgEmissionTC02e">t CO2e:</label>
                <input type="text" id="ghgEmissionTC02e" name="ghgEmissionTC02e" required>

                <button type="submit">Add Flight Data</button>
            </form>
        </div>
    </div>
</div>


<script>
    // Function to filter flights by year and redirect with the selected year in the URL
    function filterByYear() {
        const selectedYear = document.getElementById('yearFilter').value;
        const url = selectedYear ? `/flight?year=${selectedYear}` : '/flight';
        window.location.href = url; // Redirect with the year filter
    }

    function deleteFlight(flightId) {
    // Check if the flightId is valid
    if (!flightId || flightId === 'undefined') {
        console.error("Invalid flight ID:", flightId);
        alert("Invalid flight ID. Please check the data.");
        return; // Stop if the ID is invalid
    }

    if (confirm("Are you sure you want to delete this record?")) {
        fetch(`/delete_flight/${flightId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Flight record deleted successfully.");
                location.reload(); // Reload the page to update the table
            } else {
                console.error("Server error:", data.error);
                alert("An error occurred while trying to delete the flight record.");
            }
        })
        .catch(error => {
            console.error("Fetch error:", error);
            alert("An error occurred while trying to delete the flight record.");
        });
    }
}




function printFlightReport() {
    // Retrieve filter values
    const year = document.getElementById('yearFilter').value;
    let queryString = '';
    
    if (year) {
        queryString += `year=${year}`;
    }

    // Build the fetch URL based on filters
    const fetchUrl = queryString ? `/flight/all?${queryString}` : `/flight/all`;

    fetch(fetchUrl)
        .then(response => response.json())
        .then(data => {
            // Check if data is available
            if (data.length === 0) {
                alert("No data available for the selected filters.");
                return;
            }

            // Create the print layout with the report table structure
            const tableHeader = `
                <thead>
                    <tr>
                        <th>Campus</th>
                        <th>Office</th>
                        <th>Year</th>
                        <th>Traveller</th>
                        <th>Purpose</th>
                        <th>Travel Date</th>
                        <th>Flight Type</th>
                        <th>Origin</th>
                        <th>Destination</th>
                        <th>Class</th>
                        <th>One Way/Round Trip</th>
                        <th>kg CO₂e</th>
                        <th>t CO₂e</th>
                    </tr>
                </thead>`;

            const tableBody = data.map(flight => `
                <tr>
                    <td>${flight.Campus}</td>
                    <td>${flight.Office}</td>
                    <td>${flight.Year}</td>
                    <td>${flight.TravellerName}</td>
                    <td>${flight.TravelPurpose}</td>
                    <td>${flight.TravelDate}</td>
                    <td>${flight.DomesticInternational}</td>
                    <td>${flight.Origin}</td>
                    <td>${flight.Destination}</td>
                    <td>${flight.Class}</td>
                    <td>${flight.OnewayRoundTrip}</td>
                    <td>${flight.GHGEmissionKGC02e}</td>
                    <td>${flight.GHGEmissionTC02e}</td>
                </tr>`).join('');

            const printContents = `
                <div style="text-align: center; margin-top: 20px;">
                    <img src="{{ url_for('static', filename='images/bsu.png') }}" alt="Logo 1" style="width: 50px; vertical-align: middle;">
                    <h2 style="display: inline; margin: 0 20px;">Flight Consumption Report</h2>
                    <img src="{{ url_for('static', filename='images/csd.png') }}" alt="Logo 2" style="width: 50px; vertical-align: middle;">
                </div>
                <table border="1" cellspacing="0" cellpadding="5" style="width: 100%; margin-top: 20px;">
                    ${tableHeader}
                    <tbody>${tableBody}</tbody>
                </table>`;

            // Replace body content with the print layout
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print(); // Trigger the print dialog
            document.body.innerHTML = originalContents; // Restore the original page content
        })
        .catch(error => {
            console.error("Error fetching flight data:", error);
            alert("An error occurred while fetching the flight data for printing.");
        });
}


function downloadFlightExcel() {
    // Retrieve filter values for AJAX request
    const year = document.getElementById('yearFilter').value;
    let queryString = '';
    
    if (year) {
        queryString += `year=${year}`;
    }

    // Build the fetch URL based on filters
    const fetchUrl = queryString ? `/flight/all?${queryString}` : `/flight/all`;

    fetch(fetchUrl)
        .then(response => response.json())
        .then(data => {
            if (data.length === 0) {
                alert("No data available for the selected filters.");
                return;
            }

            // Create a temporary table for data processing
            const tempTable = document.createElement("table");
            
            // Create header row
            const headerRow = `
                <tr>
                    <th>Campus</th>
                    <th>Office</th>
                    <th>Year</th>
                    <th>Traveller</th>
                    <th>Purpose</th>
                    <th>Travel Date</th>
                    <th>Flight Type</th>
                    <th>Origin</th>
                    <th>Destination</th>
                    <th>Class</th>
                    <th>One Way/Round Trip</th>
                    <th>kg CO₂e</th>
                    <th>t CO₂e</th>
                </tr>`;
            tempTable.innerHTML += headerRow;

            // Populate table with data from the server
            data.forEach(flight => {
                const row = `
                    <tr>
                        <td>${flight.Campus}</td>
                        <td>${flight.Office}</td>
                        <td>${flight.Year}</td>
                        <td>${flight.TravellerName}</td>
                        <td>${flight.TravelPurpose}</td>
                        <td>${flight.TravelDate}</td>
                        <td>${flight.DomesticInternational}</td>
                        <td>${flight.Origin}</td>
                        <td>${flight.Destination}</td>
                        <td>${flight.Class}</td>
                        <td>${flight.OnewayRoundTrip}</td>
                        <td>${flight.GHGEmissionKGC02e}</td>
                        <td>${flight.GHGEmissionTC02e}</td>
                    </tr>`;
                tempTable.innerHTML += row;
            });

            try {
                // Create workbook and write to Excel file
                const workbook = XLSX.utils.table_to_book(tempTable, { sheet: "Flight Consumption" });
                XLSX.writeFile(workbook, "FlightConsumptionReport.xlsx");
            } catch (error) {
                console.error("Error exporting table to Excel:", error);
                alert("An error occurred while exporting the table to Excel. Check the console for details.");
            }
        })
        .catch(error => {
            console.error("Error fetching flight data:", error);
            alert("An error occurred while fetching the flight data for export. Please try again.");
        });
}


    // Function to open the calculator modal
    function openCalculatorModal() {
        document.getElementById('myModal').style.display = 'block';
    }

    // Function to close the modal
    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    // Pagination logic
    let currentPage = 1;
    const rowsPerPage = 15;

    function renderTable() {
        const rows = document.querySelectorAll('#reportData tr');
        const totalRows = rows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;

        rows.forEach((row, index) => {
            row.style.display = index >= startIndex && index < endIndex ? '' : 'none';
        });

        document.getElementById('page-info').innerText = `Page ${currentPage} of ${totalPages}`;
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage === totalPages;
    }

    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            renderTable();
        }
    }

    function nextPage() {
        const totalRows = document.querySelectorAll('#reportData tr').length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderTable();
        }
    }

    // Call renderTable() on page load to display the first page
    document.addEventListener('DOMContentLoaded', () => {
        renderTable();
    });

    function downloadFlightCSV() {
    // Retrieve filter values for AJAX request
    const year = document.getElementById('yearFilter').value;
    let queryString = '';

    if (year) {
        queryString += `year=${year}`;
    }

    // Build the fetch URL based on filters
    const fetchUrl = queryString ? `/flight/all?${queryString}` : `/flight/all`;

    fetch(fetchUrl)
        .then(response => response.json())
        .then(data => {
            if (data.length === 0) {
                alert("No data available for the selected filters.");
                return;
            }

            // Create CSV headers and rows
            const headers = [
                "Campus", "Office", "Year", "Traveller", "Purpose", "Travel Date", 
                "Flight Type", "Origin", "Destination", "Class", "One Way/Round Trip", 
                "kg CO₂e", "t CO₂e"
            ];
            const rows = data.map(flight => [
                flight.Campus,
                flight.Office,
                flight.Year,
                flight.TravellerName,
                flight.TravelPurpose,
                flight.TravelDate,
                flight.DomesticInternational,
                flight.Origin,
                flight.Destination,
                flight.Class,
                flight.OnewayRoundTrip,
                flight.GHGEmissionKGC02e,
                flight.GHGEmissionTC02e
            ]);

            // Convert to CSV format
            const csvContent = [
                headers.join(","),
                ...rows.map(row => row.map(value => `"${value}"`).join(","))
            ].join("\n");

            // Create a blob for the CSV file
            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);

            // Create a link to download the CSV file
            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", "FlightConsumptionReport.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        })
        .catch(error => {
            console.error("Error exporting data to CSV:", error);
            alert("An error occurred while exporting the data. Please try again.");
        });
}

</script>

    
</body>
</html>
