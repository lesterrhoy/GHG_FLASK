<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>csd_dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<style>
    /* Adjustments for the sidebar */
    .sb-topnav .navbar-nav .nav-item .nav-link {
        display: flex;
        align-items: center;
        padding: 0 8px; /* Reduced padding */
        color: white;
    }

    .sb-topnav .navbar-nav .nav-item .nav-link i {
        margin-right: 4px; /* Reduced space between icon and text */
    }

    /* Main container adjustments */
    .container-fluid.px-4 {
        padding: 1rem 1rem; /* Reduced padding for main container */
    }

    /* Sidebar adjustments for better vertical space */
    .sb-sidenav-menu {
        overflow-y: auto;
        max-height: 90vh;
    }

    #layoutSidenav_nav .sb-sidenav-menu {
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Card styling adjustments */
    .card {
        margin-bottom: 1rem; /* Reduced margin between cards */
        padding: 1rem; /* General padding inside cards */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); /* Subtle shadow */
    }

    .card h6 {
        font-size: 1rem;
        margin-bottom: 0.5rem; /* Reduced margin for titles */
    }

    .card p {
        margin-bottom: 0.25rem; /* Reduced space between paragraphs in cards */
        font-size: 0.9rem; /* Slightly smaller font for descriptions */
    }

    /* Emission overview card styling */
    .card.bg-dark {
        padding: 1rem;
        border-radius: 0.25rem;
    }

    /* Adjustments for footer spacing */
    footer.py-4 {
        padding: 1rem 0; /* Reduced padding in the footer */
    }

    /* Responsive layout tweaks */
    @media (min-width: 768px) {
        .col-2.col-md-2.col-sm-6 {
            min-width: 160px; /* Set a consistent minimum width for better alignment */
        }
    }

    /* Adjustments for the filter select box */
    .form-group {
        margin-top: 0.5rem;
        margin-bottom: 1rem; /* Reduced spacing for select box */
    }

    /* Chart container adjustments */
    .chart-container {
        padding: 1rem; /* General padding inside chart containers */
        margin-bottom: 1rem; /* Reduced margin between chart cards */
    }

    /* Landscape print styling */
    @media print {
        @page {
            size: landscape;
        }
    }
</style>

</head>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSD Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <!-- Navbar brand -->
        <a class="navbar-brand ps-3" href="{{ url_for('csd_dashboard') }}">CSD Dashboard</a>
    
        <!-- Spacer to push "Sign-out" to the right -->
        <div class="ms-auto"></div>
    
        <!-- Sign-out Icon and Link -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-power-off fa-fw"></i> Sign-out
                </a>
            </li>
        </ul>
    </nav>
    
    <!-- Sidebar and Main Content -->
    <div id="layoutSidenav">
        <!-- Sidebar -->
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu" style="overflow-y: auto; max-height: 90vh;">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{{ url_for('csd_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapsePages">
                            <div class="sb-nav-link-icon"><i class="fas fa-book-open"></i></div>
                            REPORT
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapsePages">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{{ url_for('electricity_report') }}">Electricity Report</a>
                                <a class="nav-link" href="{{ url_for('fuel_emissions_report') }}">Fuel Emissions Report</a>
                                <a class="nav-link" href="{{ url_for('water_report') }}">Water Consumption Report</a>
                                <a class="nav-link" href="{{ url_for('treated_water_report') }}">Treated Water Report</a>
                                <a class="nav-link" href="{{ url_for('waste_segregation_report') }}">Waste Segregation Report</a>
                                <a class="nav-link" href="{{ url_for('waste_unseg_report') }}">Waste Unsegregation Report</a>
                                <a class="nav-link" href="{{ url_for('food_consumption_report') }}">Food Consumption Report</a>
                                <a class="nav-link" href="{{ url_for('lpg_consumption_report') }}">LPG Consumption Report</a>
                                <a class="nav-link" href="{{ url_for('flight_emissions_report') }}">Flight Emissions Report</a>
                                <a class="nav-link" href="{{ url_for('accommodation_emissions_report') }}">Accommodation Emissions Report</a>
                            </nav>
                        </div>
                        <a class="nav-link" href="{{ url_for('manage_account') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-user-cog"></i></div>
                            Manage Account
                        </a>
                </div>
                </div>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div id="layoutSidenav_content">
            <main class="container-fluid px-4">
                <h1 style="margin-top: 0;">Dashboard</h1>



                <div class="card mb-4">
                    <div class="card-body">
                        <p style="margin-bottom: 0; line-height: 1.5; text-align: justify;">
                            The Center for Sustainable Development Dashboard offers an overview of historical and forecasted consumption and emission trends across all campuses of Batangas State University TNEU. It highlights variability in resource use, showcasing distinct fluctuations in various metrics. This analysis enables a comprehensive understanding of consumption patterns, supporting strategic decisions for improved sustainability.
                        </p>
                    </div>
                </div>
                

                <div class="container mt-3">
                    <!-- Campus Filter Form -->
                    <form method="get" action="{{ url_for('csd_dashboard') }}">
                        <div class="form-group">
                            <label for="campusFilter">Select Campus:</label>
                            <select name="campus" id="campusFilter" class="form-control" onchange="this.form.submit()">
                                <option value="all" {% if selected_campus == 'all' %}selected{% endif %}>All Campuses</option>
                                <option value="Alangilan" {% if selected_campus == 'Alangilan' %}selected{% endif %}>Alangilan</option>
                                <option value="ARASOF-Nasugbu" {% if selected_campus == 'ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                                <option value="Balayan" {% if selected_campus == 'Balayan' %}selected{% endif %}>Balayan</option>
                                <option value="Central" {% if selected_campus == 'Central' %}selected{% endif %}>Central</option>
                                <option value="JPLPC-Malvar" {% if selected_campus == 'JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                                <option value="Lemery" {% if selected_campus == 'Lemery' %}selected{% endif %}>Lemery</option>
                                <option value="Lipa" {% if selected_campus == 'Lipa' %}selected{% endif %}>Lipa</option>
                                <option value="Lobo" {% if selected_campus == 'Lobo' %}selected{% endif %}>Lobo</option>
                                <option value="Mabini" {% if selected_campus == 'Mabini' %}selected{% endif %}>Mabini</option>
                                <option value="Pablo Borbon" {% if selected_campus == 'Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                                <option value="Rosario" {% if selected_campus == 'Rosario' %}selected{% endif %}>Rosario</option>
                                <option value="San Juan" {% if selected_campus == 'San Juan' %}selected{% endif %}>San Juan</option>
                            </select>
                        </div>
                    </form>
                </div>
                

                <div class="container mt-5">
                    <!-- Total Emission Card -->
                    <div class="card bg-dark text-white mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Total Emission</h5>
                            <p>Total CO₂ Emission: {{ overall_consumption.total_emission }} CO₂e</p>
                            <p>This value represents the cumulative CO₂ emissions from all monitored sources.</p>
                        </div>
                    </div>
                
                    <div class="row">
                        <!-- Electricity Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('electricity_report') }}" class="text-decoration-none">
                                <div class="card bg-primary text-white mb-4" style="min-height: 150px;">
                                    <div class="card-body">
                                        <h6 class="card-title">Electricity</h6>
                                        <p>Current Emission: {{ overall_consumption.electricity }} CO₂e</p>
                                        <p>From electricity usage.</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        
                
                        <!-- Fuel Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('fuel_emissions_report') }}" class="text-decoration-none">
                            <div class="card bg-warning text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Fuel</h6>
                                    <p>Current Emission: {{ overall_consumption.fuel }} CO₂e</p>
                                    <p>From fuel consumption.</p>
                                </div>
                            </div>
                        </a>
                        </div>
                
                        <!-- Waste Segregated Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('waste_segregation_report') }}" class="text-decoration-none">
                            <div class="card bg-success text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Waste Segregated</h6>
                                    <p>Quantity: {{ overall_consumption.waste_segregation }} kg</p>
                                    <p>GHG Emission: {{ overall_consumption.waste_segregation_emission }} CO₂e</p>
                                </div>
                            </div>
                        </a>
                        </div>
                
                        <!-- Waste Unsegregated Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('waste_unseg_report') }}" class="text-decoration-none">
                            <div class="card bg-danger text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Waste Unsegregated</h6>
                                    <p>Quantity: {{ overall_consumption.waste_unsegregation }} kg</p>
                                    <p>GHG Emission: {{ overall_consumption.waste_unsegregation_emission }} CO₂e</p>
                                </div>
                            </div>
                            </a>
                        </div>
                
                        <!-- Treated Water Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('treated_water_report') }}" class="text-decoration-none">
                            <div class="card bg-info text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Treated Water</h6>
                                    <p>Volume: {{ overall_consumption.treated_water }} liters</p>
                                </div>
                            </div>
                        </div>
                    </a>
                    </div>
                
                    <!-- Second Row for LPG, Water Consumption, and others -->
                    <div class="row">
                        <!-- LPG Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('lpg_consumption_report') }}" class="text-decoration-none">
                            <div class="card bg-dark text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">LPG</h6>
                                    <p>Current Emission: {{ overall_consumption.lpg }} CO₂e</p>
                                </div>
                            </div>
                            </a>
                        </div>
                
                        <!-- Water Consumption Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('water_report') }}" class="text-decoration-none">
                            <div class="card bg-secondary text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Water Consumption</h6>
                                    <p>Consumption: {{ overall_consumption.water }} liters</p>
                                </div>
                            </div>
                            </a>
                        </div>
                
                        <!-- Food Waste Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('food_consumption_report') }}" class="text-decoration-none">
                            <div class="card bg-light text-dark mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Food Waste</h6>
                                    <p>Quantity: {{ overall_consumption.food_waste }} servings</p>
                                </div>
                            </div>
                            </a>
                        </div>
                
                        <!-- Accommodation Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('accommodation_emissions_report') }}" class="text-decoration-none">
                            <div class="card bg-primary text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Accommodation</h6>
                                    <p>Rooms Occupied: {{ overall_consumption.accommodation }} rooms</p>
                                </div>
                            </div>
                            </a>
                        </div>
                
                        <!-- Flight Card -->
                        <div class="col-2 col-md-2 col-sm-6">
                            <a href="{{ url_for('flight_emissions_report') }}" class="text-decoration-none">
                            <div class="card bg-warning text-white mb-4" style="min-height: 150px;">
                                <div class="card-body">
                                    <h6 class="card-title">Flight</h6>
                                    <p>Current Emission: {{ overall_consumption.flight }} CO₂e</p>
                                </div>
                            </div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Line Graphs for 10 Consumption Types -->
                <div class="row">
                    <!-- Electricity Consumption -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-bolt"></i> Electricity Consumption</div>
                            <div class="card-body"><canvas id="electricityChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Fuel Consumption -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-gas-pump"></i> Fuel Emissions</div>
                            <div class="card-body"><canvas id="fuelChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Water Consumption -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-water"></i> Water Consumption</div>
                            <div class="card-body"><canvas id="waterChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Treated Water -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-shower"></i> Treated Water</div>
                            <div class="card-body"><canvas id="treatedWaterChart"></canvas></div>
                        </div>
                    </div>

                    <!-- LPG Consumption -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-fire-alt"></i> LPG Consumption</div>
                            <div class="card-body"><canvas id="lpgChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Food Waste -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-utensils"></i> Food Waste</div>
                            <div class="card-body"><canvas id="foodChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Waste Segregation -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-recycle"></i> Waste Segregation</div>
                            <div class="card-body"><canvas id="wasteSegregatedChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Waste Unsegregation -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-trash-alt"></i> Waste Unsegregation</div>
                            <div class="card-body"><canvas id="wasteUnsegregatedChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Flight Emissions -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-plane"></i> Flight Emissions</div>
                            <div class="card-body"><canvas id="flightChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Accommodation Emissions -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header"><i class="fas fa-hotel"></i> Accommodation Emissions</div>
                            <div class="card-body"><canvas id="accommodationChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">&copy; CSD Dashboard 2023</div>
                        <div>
                            <a href="#">Privacy Policy</a>
                            &middot;
                            <a href="#">Terms &amp; Conditions</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function to get month labels with year formatting (MM/YY)
            function getMonthLabels(startMonthIndex, startYear, totalMonths) {
                let labels = [];
                for (let i = 0; i < totalMonths; i++) {
                    let monthIndex = (startMonthIndex + i) % 12;
                    let year = startYear + Math.floor((startMonthIndex + i) / 12);
                    let month = (monthIndex + 1).toString().padStart(2, '0');
                    let yearShort = year.toString().slice(-2);
                    labels.push(`${month}/${yearShort}`);
                }
                return labels;
            }
    
            // Define the start month and year for the labels
            const startMonthIndex = 6; // July (0-based index 6)
            const startYear = 2023;
    
            // Generate labels from 07/23 to 08/24 (14 months)
            const labels = getMonthLabels(startMonthIndex, startYear, 14);
    
            // Extract forecast data from the template context
            const forecastData = {{ forecast_data | tojson }};
    
            // Function to create charts for each forecast
            function createChart(chartId, label, data, historicalColor, forecastColor) {
                const ctx = document.getElementById(chartId).getContext('2d');
                const historicalData = data.slice(0, 12); // First 12 points for historical data
                const futureData = data.slice(12); // Last 2 points for forecast data
    
                // Combine historical and forecast data into a single dataset for a continuous line
                const combinedData = [...historicalData, ...futureData];
    
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Historical Data',
                                data: historicalData,
                                borderColor: historicalColor,
                                fill: false,
                                borderWidth: 2,
                                pointStyle: 'circle',
                                pointBackgroundColor: historicalColor,
                            },
                            {
                                label: 'Forecast Data',
                                data: combinedData,
                                borderColor: forecastColor,
                                fill: false,
                                borderWidth: 2,
                                borderDash: [5, 5], // Dashed line for forecast
                                pointStyle: 'circle',
                                pointBackgroundColor: function(context) {
                                    return context.dataIndex < 12 ? historicalColor : forecastColor;
                                }
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        title: { display: true, text: `${label} Forecast` },
                        scales: {
                            x: { title: { display: true, text: 'Month' } },
                            y: { title: { display: true, text: 'Value' }, beginAtZero: true }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }
    
            // Create all charts for each forecast data
            createChart('electricityChart', 'Electricity', forecastData.electricity_forecast, 'darkblue', 'red');
            createChart('fuelChart', 'Fuel', forecastData.fuel_forecast, 'green', 'red');
            createChart('wasteSegregatedChart', 'Waste Segregated', forecastData.waste_segregation_forecast, 'darkorange', 'red');
            createChart('wasteUnsegregatedChart', 'Waste Unsegregated', forecastData.waste_unsegregation_forecast, 'saddlebrown', 'red');
            createChart('treatedWaterChart', 'Treated Water', forecastData.treated_water_forecast, 'teal', 'red');
            createChart('waterChart', 'Water Consumption', forecastData.water_forecast, 'darkgoldenrod', 'red');
            
            // Additional charts
            createChart('lpgChart', 'LPG Consumption', forecastData.lpg_forecast, 'purple', 'red');
            createChart('foodChart', 'Food Waste', forecastData.food_waste_forecast, 'gray', 'red');
            createChart('flightChart', 'Flight Emissions', forecastData.flight_forecast, 'navy', 'red');
            createChart('accommodationChart', 'Accommodation Emissions', forecastData.accommodation_forecast, 'pink', 'red');
        });

        function filterData() {
    const campus = document.getElementById('campusFilter').value;
    window.location.href = `/csd_dashboard?campus=${campus}`;
}

    </script>
    
    
</body>
</html>
