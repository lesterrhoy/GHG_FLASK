<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Fuel Consumption</title>
    <link rel="icon" href="{{ url_for('static', filename='images/emu.jpg') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        /* Table Styling */
      /* Simula dito yung style  pababa*/
   body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f8fc;
            margin: 0;
            padding: 0;
        }

        .table-wrapper {
            margin: 30px;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h1 {
            font-size: 20px;
            color: #333;
            font-weight: 500;
        }

        .table-header .actions {
            display: flex;
            gap: 10px;
        }

        .table-header .actions button {
            border: none;
            padding: 10px 15px;
            background-color: #003c57;
            color: #fff;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .table-header .actions button:hover {
            background-color: #00587a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 10px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        th {
            background: linear-gradient(180deg, #f5b3b3, #f77d7d, #f5756c, #c62828); /* Bold red gradient */
            color: #FFFFFF; /* White text for contrast */
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            padding: 10px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        th:hover {
            background: linear-gradient(180deg, #f89f9f, #f85e5e, #e53935, #b71c1c); /* Slightly darker red tones on hover */
            color: #080404; /* Maintain contrast */
            cursor: pointer;
        }

        th:first-child {
            border-top-left-radius: 8px;
        }

        th:last-child {
            border-top-right-radius: 8px;
        }

        td {
            font-size: 10px;
            color: #333;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #eef5f9;
        }

        .actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .delete-btn {
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s ease;
        }

        .delete-btn i {
            font-size: 18px;
            color: #f44336; /* Vibrant red for the default state */
            transition: color 0.3s ease; /* Smooth transition for hover effect */
        }

        .delete-btn:hover {
            transform: scale(1.1);  /* Slight scale on hover for better interaction feedback */
        }

        .delete-btn i:hover {
            color: #c62828; /* Deep red on hover for a bold effect */
        }
             #yearFilter, #quarterFilter, #monthFilter {
             margin: 10px 0; /* Adds top and bottom margin */
              }
     
             body {
                 font-family: 'Roboto', sans-serif;
                 height: 100vh;
                 display: flex;
                 flex-direction: column;
             }
     
             .header {
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 background-color: #e0e0e0;
                 padding-top: 10px;
                 padding-bottom: 10px;
                 border-bottom: 2px solid #ccc;
                 z-index: 1;
                 position: relative;
             }
     
             .header .logo {
                 width: 50px;
                 height: auto;
                 margin-left: 100px;
                 transition: margin-left 0.5s ease;
             }
     
             .header .logo.csd {
                 margin-left: 20px;
             }
     
             .header .title {
                 font-size: 28px;
                 font-weight: bold;
                 color: #333;
                 text-align: center;
                 flex-grow: 1;
             }
     
             .content {
                 flex-grow: 1;
                 background-color: #d50000;
                 padding: 40px;
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 transition: margin-left 0.5s ease;
             }
     
             .filter-container {
                 margin-bottom: 20px;
             }
     
             .filter-container select {
                 padding: 10px;
                 font-size: 16px;
             }
     
             #reportTable {
                 width: 100%;
                 border-collapse: collapse;
             }
     
             #reportTable th, #reportTable td {
                 padding: 10px;
                 border: 1px solid #000;
             }
             .modal {
    display: none;
    justify-content: center;
    align-items: flex-start;
    position: fixed;
    z-index: 2;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    padding-top: 50px;
}

.modal-content {
    background-color: #fefefe;
    margin: 2% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 30%; /* Adjust the width to make it smaller */
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}


.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

/* start modal */
.container {
    background: #f44336; /* Solid red color matching the delete icon */
    padding: 15px;
    width: 100%;
    border-radius: 10px;
    color: #ffffff; /* White text for readability */
    display: flex;
    justify-content: space-between;
    align-items: center; /* Align content vertically */
    box-sizing: border-box;
    transition: background 0.3s ease; /* Smooth transition for hover effect */
}

.container:hover {
    background: #e53935; /* Slightly darker red for hover */
}
/* end */

.form-container {
    width: 100%; /* Adjust the width to allow more space for form fields */
}
.form-container form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.form-container form label {
    font-size: 14px;
    margin-bottom: 5px;
}

.form-container form select,
.form-container form input {
    width: 100%; /* This makes the input/select fill the entire available width */
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    color: #333;
    font-size: 14px;
}


     
     .form-container form button {
         padding: 10px; /* Smaller button padding */
         background-color: #666;
         color: #fff;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         font-size: 14px; /* Smaller font size for buttons */
     }
     
     .form-container form button:hover {
         background-color: #555;
     }
     
     .result-container {
         background-color: #e0e0e0;
         padding: 15px; /* Smaller padding for result container */
         border-radius: 10px;
     }
     
     #result {
         background-color: #fff;
         color: #333;
         padding: 15px; /* Reduced padding */
         border-radius: 10px;
         margin-top: 15px;
     }
     
     canvas {
         margin-top: 20px;
         display: block;
         width: 100%;
     }
     
     .buttons-container {
         display: flex;
         justify-content: center;
         gap: 10px; /* Reduced gap between buttons */
         margin-top: 20px;
     }
     
     button {
         padding: 10px 15px; /* Reduced button padding */
         font-size: 14px; /* Smaller button font size */
         border: none;
         border-radius: 5px;
         cursor: pointer;
         transition: background-color 0.3s ease;
         margin-left: 10px; /* Adds space to move the button to the right */
     }

    /* start button */
button.btn-primary {
    background-color: #f44336; /* Matching red background color */
    color: #fff; /* White text for readability */
    border: none; /* Remove default border */
    padding: 10px 20px; /* Adjust padding for a better button appearance */
    border-radius: 5px; /* Rounded corners */
    font-size: 16px; /* Font size for the button */
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

button.btn-primary:hover {
    background-color: #e53935; /* Slightly darker red for hover effect */
}
/* end*/
     
     button:first-child {
         background-color: #666;
         color: white;
     }
     
     button:first-child:hover {
         background-color: #555;
     }
     
     button:last-child {
         background-color: #ffffff;
         color: rgb(0, 0, 0);
     }
     
     button:last-child:hover {
         background-color: #d50000;
     }
     
     .pagination-container {
         margin-top: 20px; /* Add some margin above the pagination */
         text-align: center;
     }
     
     .pagination .page-item .page-link {
         color: black; /* Set font color to black */
     }
     
     .pagination .page-item.active .page-link {
         background-color:#f44336; /* Active page with the same red color */
         border-color: #f44336;
         color: white; /* White text for the active page */
     }
     
     .pagination .page-link:hover {
         background-color: #f44336; /* Darker red on hover */
         color: white; /* White text on hover */
     }
     
     
     
             .delete-icon {
                 cursor: pointer;
                 color: #fd0808;
             }
     
             @media screen and (max-width: 768px) {
         table {
             font-size: 10px; /* Adjusted font size for smaller screens */
         }
     
         th, td {
             padding: 6px; /* Adjusted padding for smaller screens */
         }
     
         .modal-content {
             width: 90%; /* Modal width adjusts to smaller screens */
         }
     
         .form-container,
         .result-container {
             width: 100%; /* Stack form and result container on smaller screens */
         }
     
         .container {
             padding: 10px; /* Adjust padding for smaller screens */
         }
     }
         </style>  
</head>
<body>
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="{{ url_for('emu_dashboard') }}">EMU <span style="text-transform: uppercase; font-style: italic;">{{ session['campus'] }} CAMPUS</span></a>
       <!-- Spacer to push "Sign-out" to the right -->
       <div class="ms-auto"></div>
    
       <!-- Sign-out Icon and Link -->
       <ul class="navbar-nav">
           <li class="nav-item">
               <a class="nav-link" href="{{ url_for('logout') }}">
                   <i class="fas fa-power-off fa-fw"></i> Sign-out
               </a>
           </li>
       </ul>
    </nav>

    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{{ url_for('emu_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <div class="sb-sidenav-menu-heading">Consumption Report</div>
                        <nav class="sb-sidenav-menu-nested nav">
                            <a class="nav-link" href="{{ url_for('electricity_consumption') }}">Electricity</a>
                            <a class="nav-link" href="{{ url_for('emu_fuel') }}">Fuel</a>
                            <a class="nav-link" href="{{ url_for('water_consumption') }}">Water Consumption</a>
                            <a class="nav-link" href="{{ url_for('treated_water') }}">Treated Water</a>
                            <a class="nav-link" href="{{ url_for('waste_segregation') }}">Waste Segregation</a>
                            <a class="nav-link" href="{{ url_for('waste_unsegregation') }}">Waste Unsegregation</a>
                            </nav>
                    </div>
                </div>
            </nav>
        </div>

        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <h1 class="mt-4">Fuel Consumption</h1>
                    <ol class="breadcrumb mb-4">
                        <li class="breadcrumb-item"><a href="{{ url_for('emu_dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item active">Fuel</li>
                    </ol>

                    <div class="card mb-4">
                        <div class="card-body">
                            Fuel consumption primarily includes emissions from vehicles used for transportation, generators, and other equipment that rely on fuel such as gasoline, diesel, or liquefied petroleum gas (LPG). The combustion of these fuels releases carbon dioxide (CO2), methane (CH4), and nitrous oxide (N2O) into the atmosphere, all of which are potent greenhouse gases contributing to climate change.
                        </div>
                    </div>
                    
                    <div id="FuelSection">
                    <div class="buttons-container mt-3 d-flex justify-content-start align-items-center gap-2">
                    <button id="openModalBtn" style="background-color: #f44336;"btn btn-primary onclick="openCalculatorModal()">Calculate</button>
                    <button class="btn btn-primary" onclick="printReport()">Print Report</button>
                    <button class="btn btn-primary" onclick="downloadExcel()">Download Excel</button>
                    <button class="btn btn-primary" style="background-color: #f44336; color: #ffffff;" onclick="downloadCSV()">Download CSV</button>
                    </div>
                    </div>


                <label for="yearFilter">Filter by Year:</label>
                <select id="yearFilter" onchange="filterByYear()">
                    <option value="">All Years</option>
                    <option value="2014" {% if selected_year == "2014" %}selected{% endif %}>2014</option>
                    <option value="2015" {% if selected_year == "2015" %}selected{% endif %}>2015</option>
                    <option value="2016" {% if selected_year == "2016" %}selected{% endif %}>2016</option>
                    <option value="2017" {% if selected_year == "2017" %}selected{% endif %}>2017</option>
                    <option value="2018" {% if selected_year == "2018" %}selected{% endif %}>2018</option>
                    <option value="2019" {% if selected_year == "2019" %}selected{% endif %}>2014</option>
                    <option value="2020" {% if selected_year == "2020" %}selected{% endif %}>2020</option>
                    <option value="2021" {% if selected_year == "2021" %}selected{% endif %}>2021</option>
                    <option value="2022" {% if selected_year == "2022" %}selected{% endif %}>2022</option>
                    <option value="2023" {% if selected_year == "2023" %}selected{% endif %}>2023</option>
                    <option value="2024" {% if selected_year == "2024" %}selected{% endif %}>2024</option>
                </select>
                        

                    <div class="modal" id="myModal" style="display: none;">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="container">
                                <div class="form-container">
                                    <form id="fuelForm" method="POST" action="{{ url_for('emu_fuel') }}">
                                        <label for="campus">Campus:</label>
                                        <select id="campus" name="campus" disabled>
                                            <option value="" {% if not session.get('campus') %}selected{% endif %}></option>
                                            <option value="Alangilan" {% if session.get('campus') == 'Alangilan' %}selected{% endif %}>Alangilan</option>
                                            <option value="ARASOF-Nasugbu" {% if session.get('campus') == 'ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                                            <option value="Balayan" {% if session.get('campus') == 'Balayan' %}selected{% endif %}>Balayan</option>
                                            <option value="Central" {% if session.get('campus') == 'Central' %}selected{% endif %}>Central</option>
                                            <option value="JPLPC-Malvar" {% if session.get('campus') == 'JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                                            <option value="Lemery" {% if session.get('campus') == 'Lemery' %}selected{% endif %}>Lemery</option>
                                            <option value="Lipa" {% if session.get('campus') == 'Lipa' %}selected{% endif %}>Lipa</option>
                                            <option value="Lobo" {% if session.get('campus') == 'Lobo' %}selected{% endif %}>Lobo</option>
                                            <option value="Mabini" {% if session.get('campus') == 'Mabini' %}selected{% endif %}>Mabini</option>
                                            <option value="Pablo Borbon" {% if session.get('campus') == 'Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                                            <option value="Rosario" {% if session.get('campus') == 'Rosario' %}selected{% endif %}>Rosario</option>
                                            <option value="San Juan" {% if session.get('campus') == 'San Juan' %}selected{% endif %}>San Juan</option>
                                        </select>
                                        <label for="date">Date:</label>
                                        <input type="date" id="date" name="date" required>

                                        <label for="driver">Driver:</label>
                                        <input type="text" id="driver" name="driver" required>

                                        <label for="type">Type:</label>
                                        <select id="type" name="type" required>
                                            <option value="" disabled selected></option>
                                            <option value="Vehicle">Vehicle</option>
                                            <option value="Equipment">Equipment</option>
                                        </select>

                                        <label for="vehicleType">Vehicle Type:</label>
                                        <select id="vehicleType" name="vehicle_equipment" required>
                                            <option value=""></option>
                                            <option value="Generator">Generator</option>
                                            <option value="Foton Bus">Foton Bus</option>
                                            <option value="Honda Civic">Honda Civic</option>
                                            <option value="Hyundai Starex">Hyundai Starex</option>
                                            <option value="Isuzu Sportivo">Isuzu Sportivo</option>
                                            <option value="Isuzu Traviz">Isuzu Traviz</option>
                                            <option value="Mitsubishi Adventure">Mitsubishi Adventure</option>
                                            <option value="Mitsubishi L300 FB Van">Mitsubishi L300 FB Van</option>
                                            <option value="Nissan Urvan">Nissan Urvan</option>
                                            <option value="Toyota Avanza">Toyota Avanza</option>
                                            <option value="Toyota Grandia">Toyota Grandia</option>
                                            <option value="Toyota Hi-Ace">Toyota Hi-Ace</option>
                                            <option value="Toyota Hilux">Toyota Hilux</option>
                                            <option value="Toyota Minibus">Toyota Minibus</option>
                                        </select>

                                        <label for="plateNo">Plate Number:</label>
                                        <input type="text" id="plateNo" name="plateNo" required>

                                        <label for="category">Category:</label>
                                        <select id="category" name="category">
                                            <option value=""></option>
                                            <option value="fuel">Fuel</option>
                                            <option value="repair">Repair and Maintenance</option>
                                        </select>

                                        <label for="fuelType">Fuel Type:</label>
                                        <select id="fuelType" name="fuelType" required>
                                            <option value=""></option>
                                            <option value="Diesel">Diesel</option>
                                            <option value="Gasoline">Gasoline</option>
                                        </select>

                                        <label for="itemDescription">Item Description:</label>
                                        <input type="text" id="itemDescription" name="itemDescription" required>

                                        <label for="transactionNo">Transaction Number:</label>
                                        <input type="text" id="transactionNo" name="transactionNo" required>

                                        <label for="odometer">Odometer:</label>
                                        <input type="number" id="odometer" name="odometer" required>

                                        <label for="quantityLiters">Quantity Liters:</label>
                                        <input type="number" id="quantityLiters" step="0.01" name="quantityLiters" required>

                                        <label for="totalAmount">Total Amount:</label>
                                        <input type="number" id="totalAmount" step="0.01" name="totalAmount" required>

                                        <button type="button" class="yellow-button" onclick="calculateAndSubmit()">Calculate</button>


                                        <!-- New fields to show the calculated results -->
                                        <div style="margin: 20px; font-family: Arial, sans-serif; max-width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                            <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                                                <label for="totalEmissionKg" style="font-weight: bold; color: #333; margin-right: 10px;">Total Emission (kg CO₂-e):</label>
                                                <input type="number" id="totalEmissionKg" name="totalEmissionKg" readonly 
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;" value="0.00">
                                            </div>
                                            <div style="margin-bottom: 0; display: flex; justify-content: space-between; align-items: center;">
                                                <label for="totalEmissionTons" style="font-weight: bold; color: #333; margin-right: 10px;">Total Emission (t CO₂-e):</label>
                                                <input type="number" id="totalEmissionTons" name="totalEmissionTons" readonly 
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;" value="0.00">
                                            </div>
                                        </div>

                                        
                                        <!-- "Generate Report" Button -->
                                        <button type="button" class="yellow-button" onclick="generateReport()">Generate Report</button>
                                    </form>
                                </div>


                            </div>
                        </div>
                    </div>


                    <div class="table-responsive mt-4">
                            <div class="table-wrapper">
                        <table id="reportTable">
                            <thead>
    <tr>
        <th>Date</th>
        <th>Driver</th>
        <th>Type</th> <!-- Add this -->
        <th>Vehicle Type</th>
        <th>Plate Number</th>
        <th>Category</th> <!-- Add this -->
        <th>Fuel Type</th>
        <th>Quantity (Liters)</th>
        <th>Total Amount</th>
        <th>CO₂ Emission (kg)</th>
        <th>NH₄ Emission (kg CO₂-e)</th>
        <th>N₂O Emission (kg CO₂-e)</th>
        <th>Total Emission (kg CO₂-e)</th>
        <th>Total Emission (t CO₂-e)</th>
        <th>Actions</th>
    </tr>
</thead>
<tbody id="reportData">
    {% for report in reports %}
    <tr data-id="{{ report.id }}">
        <td>{{ report.date }}</td>
        <td>{{ report.driver }}</td>
        <td>{{ report.type }}</td>
        <td>{{ report.vehicle_equipment }}</td>
        <td>{{ report.plate_no }}</td>
        <td>{{ report.category }}</td>
        <td>{{ report.fuel_type }}</td>
        <td>{{ report.quantity_liters }}</td>
        <td>{{ report.total_amount }}</td>
        <td>{{ report.co2_emission }}</td>
        <td>{{ report.nh4_emission }}</td>
        <td>{{ report.n2o_emission }}</td>
        <td>{{ report.total_emission }}</td>
        <td>{{ report.total_emission_t }}</td>
        <td>
            <button class="delete-btn" onclick="deleteRow({{ report.id }})"><i class="fa-solid fa-trash"></i></button>
        </td>
    </tr>
    {% endfor %}
</tbody>
                        </table>
                            </div>
                    </div>

                     <!-- Pagination controls -->
<div class="pagination-container">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            {% if total_pages > 1 %}
                <!-- Previous button -->
                <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('emu_fuel', page=current_page - 1) }}" tabindex="-1">Previous</a>
                </li>
                
                <!-- Page numbers -->
                <span>Page {{ current_page }} of {{ total_pages }}</span>
                
                <!-- Next button -->
                <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('emu_fuel', page=current_page + 1) }}">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

                </div>
            </main>

        
        </div>
    </div>

    <script>
     function calculateAndSubmit() {
    const fuelType = document.getElementById('fuelType').value;
    const quantityLiters = parseFloat(document.getElementById('quantityLiters').value);

    if (isNaN(quantityLiters) || quantityLiters <= 0) {
        alert("Please enter a valid quantity in liters.");
        return;
    }

    // Emission factors and GWP multipliers for CO₂-equivalent conversion
    const emissionFactors = {
        "Diesel": { 
            CO2_factor: 2.556, 
            NH4_factor: 0.00011, 
            N2O_factor: 0.000151, 
            GWP_NH4: 25, 
            GWP_N2O: 298 
        },
        "Gasoline": { 
            CO2_factor: 2.175, 
            NH4_factor: 0.00024, 
            N2O_factor: 0.00058, 
            GWP_NH4: 25, 
            GWP_N2O: 298 
        }
    };

    // Validate fuel type and retrieve relevant emission factors
    const factors = emissionFactors[fuelType];
    if (!factors) {
        alert("Please select a valid fuel type.");
        return;
    }

    // Calculate each emission in kg
    const co2Emission = quantityLiters * factors.CO2_factor;
    const nh4Emission = quantityLiters * factors.NH4_factor * factors.GWP_NH4; // Convert NH₄ to CO₂-e using GWP
    const n2oEmission = quantityLiters * factors.N2O_factor * factors.GWP_N2O; // Convert N₂O to CO₂-e using GWP
    const totalEmission = co2Emission + nh4Emission + n2oEmission;  // Sum of all emissions in kg CO₂-e
    const totalEmissionT = totalEmission / 1000;  // Convert kg CO₂-e to tons CO₂-e

    // Display calculated values in the form
    document.getElementById('totalEmissionKg').value = totalEmission.toFixed(2);
    document.getElementById('totalEmissionTons').value = totalEmissionT.toFixed(3);

    // Prepare form data with calculated emissions
    const formData = new FormData(document.getElementById('fuelForm'));
    formData.append('co2_emission', co2Emission.toFixed(2));
    formData.append('nh4_emission', nh4Emission.toFixed(2));
    formData.append('n2o_emission', n2oEmission.toFixed(2));
    formData.append('total_emission', totalEmission.toFixed(2));
    formData.append('total_emission_t', totalEmissionT.toFixed(3));

    // Submit data via fetch
    fetch('/emu_fuel', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const newRow = `
                <tr data-id="${data.data.id}">
                    <td>${data.data.campus}</td>
                    <td>${data.data.date}</td>
                    <td>${data.data.driver}</td>
                    <td>${data.data.type}</td>
                    <td>${data.data.vehicle_equipment}</td>
                    <td>${data.data.plate_no}</td>
                    <td>${data.data.category}</td>
                    <td>${data.data.fuel_type}</td>
                    <td>${data.data.quantity_liters}</td>
                    <td>${data.data.total_amount}</td>
                    <td>${data.data.co2_emission}</td>
                    <td>${data.data.nh4_emission}</td>
                    <td>${data.data.n2o_emission}</td>
                    <td>${data.data.total_emission}</td>
                    <td>${data.data.total_emission_t}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteRow(${data.data.id})">Delete</button>
                    </td>
                </tr>
            `;
            document.getElementById('reportData').insertAdjacentHTML('beforeend', newRow);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}




function generateReport() {
    // Close the modal after calculation
    const modal = document.getElementById('myModal');
    modal.style.display = 'none';

    // Proceed with form submission if needed
    // You can trigger form submission or further action here

    // Refresh the page
    location.reload();
}
       
        
        
        function deleteRow(id) {
    // Confirm the deletion
    if (confirm("Are you sure you want to delete this record?")) {
        fetch(`/delete_fuel_record/${id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Find the table row with the corresponding record ID
                const row = document.querySelector(`tr[data-id='${id}']`);
                if (row) {
                    // Remove the row from the table
                    row.remove();
                }
            } else {
                alert("Error deleting record: " + data.message);
            }
        })
        .catch(error => {
            console.error('Delete error:', error);
        });
    }
}
        function openCalculatorModal() {
            const modal = document.getElementById('myModal');
            modal.style.display = 'block'; // Show the modal
        }

        function closeModal() {
            const modal = document.getElementById('myModal');
            modal.style.display = 'none'; // Hide the modal
        }

        function reloadPage() {
            // Reset the form fields inside the modal
            const fuelForm = document.getElementById('fuelForm');
            fuelForm.reset();

            // Clear the result display
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';

            // Clear the chart if it exists
            const emissionChart = document.getElementById('emissionChart');
            const ctx = emissionChart.getContext('2d');
            ctx.clearRect(0, 0, emissionChart.width, emissionChart.height); // Clear the canvas
        }
    function displayResults(data) {
        // Existing code to show results...

    // Optionally, you can also append the new row to the table
    const newRow = `
        <tr>
            <td>${data.campus}</td>
            <td>${data.date}</td>
            <td>${data.driver}</td>
            <td>${data.type}</td>
            <td>${data.vehicle_equipment}</td>
            <td>${data.plate_no}</td>
            <td>${data.category}</td>
            <td>${data.fuel_type}</td>
            <td>${data.quantity_liters}</td>
            <td>${data.total_amount}</td>
            <td>${data.co2_emission}</td>
            <td>${data.nh4_emission}</td>
            <td>${data.n2o_emission}</td>
            <td>${data.total_emission}</td>
            <td>${data.total_emission_t}</td>
            <td>
                <button class="btn btn-danger btn-sm" onclick="deleteRow(${data.id})">Delete</button>
            </td>
        </tr>
    `;
    document.getElementById('reportData').insertAdjacentHTML('beforeend', newRow);
}


function printReport() {
    // Retrieve filter values
    const year = document.getElementById('yearFilter').value;
    const category = document.getElementById('categoryFilter') ? document.getElementById('categoryFilter').value : '';
    const fuelType = document.getElementById('fuelTypeFilter') ? document.getElementById('fuelTypeFilter').value : '';

    // Build the query string based on filters
    let queryString = '';
    if (year) queryString += `year=${year}&`;
    if (category) queryString += `category=${category}&`;
    if (fuelType) queryString += `fuelType=${fuelType}`;

    // Determine fetch URL
    const fetchUrl = queryString ? `/emu_fuel/all?${queryString}` : `/emu_fuel/all`;

    // Fetch data from the server based on the filters
    fetch(fetchUrl)
        .then(response => response.json())
        .then(data => {
            // Generate table content for printing
            const tableHeader = `
                <thead>
                    <tr>
                        <th>Campus</th>
                        <th>Date</th>
                        <th>Driver</th>
                        <th>Type</th>
                        <th>Vehicle Type</th>
                        <th>Plate Number</th>
                        <th>Category</th>
                        <th>Fuel Type</th>
                        <th>Quantity (Liters)</th>
                        <th>Total Amount</th>
                        <th>CO₂ Emission (kg)</th>
                        <th>NH₄ Emission (kg CO₂-e)</th>
                        <th>N₂O Emission (kg CO₂-e)</th>
                        <th>Total Emission (kg CO₂-e)</th>
                        <th>Total Emission (t CO₂-e)</th>
                    </tr>
                </thead>`;

            const tableBody = data.map(report => `
                <tr>
                    <td>${report.campus}</td>
                    <td>${report.date}</td>
                    <td>${report.driver}</td>
                    <td>${report.type}</td>
                    <td>${report.vehicle_equipment}</td>
                    <td>${report.plate_no}</td>
                    <td>${report.category}</td>
                    <td>${report.fuel_type}</td>
                    <td>${report.quantity_liters}</td>
                    <td>${report.total_amount}</td>
                    <td>${report.co2_emission}</td>
                    <td>${report.nh4_emission}</td>
                    <td>${report.n2o_emission}</td>
                    <td>${report.total_emission}</td>
                    <td>${report.total_emission_t}</td>
                </tr>`).join('');

            const printContents = `
                <div class="header">
                    <img src="{{ url_for('static', filename='images/bsu.png') }}" alt="Logo" style="width: 50px; height: auto;">
                    <h2>Fuel Consumption Report</h2>
                    <img src="{{ url_for('static', filename='images/csd.png') }}" alt="Logo" style="width: 50px; height: auto;">
                </div>
                <table border="1" cellspacing="0" cellpadding="5">
                    ${tableHeader}
                    <tbody>${tableBody}</tbody>
                </table>`;

            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        })
        .catch(error => console.error('Error fetching data:', error));
}
function downloadExcel() {
    // Retrieve filter values from the current page
    const year = document.getElementById('yearFilter').value || '';
    const category = document.getElementById('categoryFilter') ? document.getElementById('categoryFilter').value : '';
    const fuelType = document.getElementById('fuelTypeFilter') ? document.getElementById('fuelTypeFilter').value : '';

    // Build the query string based on filters
    let queryString = '';
    if (year) queryString += `year=${year}&`;
    if (category) queryString += `category=${category}&`;
    if (fuelType) queryString += `fuelType=${fuelType}`;

    // Remove trailing "&" if present
    queryString = queryString.endsWith('&') ? queryString.slice(0, -1) : queryString;
    const fetchUrl = queryString ? `/emu_fuel/all?${queryString}` : `/emu_fuel/all`;

    // Fetch data from the server
    fetch(fetchUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch data');
            }
            return response.json();
        })
        .then(data => {
            if (!data || data.length === 0) {
                alert('No data available to export.');
                return;
            }

            // Convert the data into a worksheet and create a workbook
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Fuel Consumption');

            // Add custom headers if necessary
            XLSX.utils.sheet_add_aoa(worksheet, [[
                'Campus', 'Date', 'Driver', 'Type', 'Vehicle Type', 'Plate Number',
                'Category', 'Fuel Type', 'Quantity (Liters)', 'Total Amount',
                'CO₂ Emission (kg)', 'NH₄ Emission (kg CO₂-e)', 'N₂O Emission (kg CO₂-e)',
                'Total Emission (kg CO₂-e)', 'Total Emission (t CO₂-e)'
            ]], { origin: 'A1' });

            // Save the workbook to an Excel file
            XLSX.writeFile(workbook, 'FuelConsumptionReport.xlsx');
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while exporting the data. Please try again.');
        });
}

        function deleteRow(id) {
            // Implement AJAX call to delete the row
            fetch(`/delete_fuel_record/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Find the table row with the corresponding record ID
                    const row = document.querySelector(`tr[data-id='${id}']`);
                    if (row) {
                        // Remove the row from the table
                        row.remove();
                    }
                } else {
                    alert("Error deleting record: " + data.message);
                }
            })
            .catch(error => {
                console.error('Delete error:', error);
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const selectedYear = urlParams.get('year');
    
    if (selectedYear) {
        const yearFilter = document.getElementById('yearFilter');
        const options = yearFilter.options;
        
        for (let i = 0; i < options.length; i++) {
            if (options[i].value === selectedYear) {
                options[i].selected = true;
                break;
            }
        }
    }
});

function filterByYear() {
    const selectedYear = document.getElementById('yearFilter').value;
    let url = '/emu_fuel?page=1';  // Start at the first page
    
    if (selectedYear) {
        url += `&year=${selectedYear}`;
    }

    // Redirect to the filtered page
    window.location.href = url;
}

function downloadCSV() {
    // Retrieve filter values from the current page
    const year = document.getElementById('yearFilter').value || '';
    const category = document.getElementById('categoryFilter') ? document.getElementById('categoryFilter').value : '';
    const fuelType = document.getElementById('fuelTypeFilter') ? document.getElementById('fuelTypeFilter').value : '';

    // Build the query string based on filters
    let queryString = '';
    if (year) queryString += `year=${year}&`;
    if (category) queryString += `category=${category}&`;
    if (fuelType) queryString += `fuelType=${fuelType}`;
    
    queryString = queryString.endsWith('&') ? queryString.slice(0, -1) : queryString;
    const fetchUrl = queryString ? `/emu_fuel/all?${queryString}` : `/emu_fuel/all`;

    // Fetch the data from the server
    fetch(fetchUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch data');
            }
            return response.json();
        })
        .then(data => {
            if (!data || data.length === 0) {
                alert('No data available to export.');
                return;
            }

            // Generate CSV content
            const headers = [
                "Campus", "Date", "Driver", "Type", "Vehicle Type", "Plate Number",
                "Category", "Fuel Type", "Quantity (Liters)", "Total Amount",
                "CO₂ Emission (kg)", "NH₄ Emission (kg CO₂-e)", "N₂O Emission (kg CO₂-e)",
                "Total Emission (kg CO₂-e)", "Total Emission (t CO₂-e)"
            ];
            const csvRows = [headers.join(",")];

            data.forEach(report => {
                const row = [
                    report.campus,
                    report.date,
                    report.driver,
                    report.type,
                    report.vehicle_equipment,
                    report.plate_no,
                    report.category,
                    report.fuel_type,
                    report.quantity_liters,
                    report.total_amount,
                    report.co2_emission,
                    report.nh4_emission,
                    report.n2o_emission,
                    report.total_emission,
                    report.total_emission_t
                ].join(",");
                csvRows.push(row);
            });

            // Create a Blob from the CSV content
            const csvBlob = new Blob([csvRows.join("\n")], { type: "text/csv" });
            const csvUrl = URL.createObjectURL(csvBlob);

            // Create a temporary download link
            const tempLink = document.createElement("a");
            tempLink.href = csvUrl;
            tempLink.download = "FuelConsumptionReport.csv";
            document.body.appendChild(tempLink);
            tempLink.click();
            document.body.removeChild(tempLink);
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while exporting the data. Please try again.');
        });
}


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>