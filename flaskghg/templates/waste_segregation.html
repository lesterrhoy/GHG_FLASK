<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Waste Segregation</title>
    <link rel="icon" href="{{ url_for('static', filename='images/emu.jpg') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/emucss.css') }}" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
         /* Table Styling */
        /* Simula dito yung style  pababa*/
   body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f8fc;
            margin: 0;
            padding: 0;
        }

        .table-wrapper {
            margin: 30px;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h1 {
            font-size: 20px;
            color: #333;
            font-weight: 500;
        }

        .table-header .actions {
            display: flex;
            gap: 10px;
        }

        .table-header .actions button {
            border: none;
            padding: 10px 15px;
            background-color: #003c57;
            color: #fff;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .table-header .actions button:hover {
            background-color: #00587a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 10px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        th {
            background: linear-gradient(180deg, #f5b3b3, #f77d7d, #f5756c, #c62828); /* Bold red gradient */
            color: #FFFFFF; /* White text for contrast */
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            padding: 10px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        th:hover {
            background: linear-gradient(180deg, #f89f9f, #f85e5e, #e53935, #b71c1c); /* Slightly darker red tones on hover */
            color: #080404; /* Maintain contrast */
            cursor: pointer;
        }

        th:first-child {
            border-top-left-radius: 8px;
        }

        th:last-child {
            border-top-right-radius: 8px;
        }

        td {
            font-size: 10px;
            color: #333;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #eef5f9;
        }

        .actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .delete-btn {
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s ease;
        }

        .delete-btn i {
            font-size: 18px;
            color: #f44336; /* Vibrant red for the default state */
            transition: color 0.3s ease; /* Smooth transition for hover effect */
        }

        .delete-btn:hover {
            transform: scale(1.1);  /* Slight scale on hover for better interaction feedback */
        }

        .delete-btn i:hover {
            color: #c62828; /* Deep red on hover for a bold effect */
        }
             #yearFilter, #quarterFilter, #monthFilter {
             margin: 10px 0; /* Adds top and bottom margin */
              }
     
             body {
                 font-family: 'Roboto', sans-serif;
                 height: 100vh;
                 display: flex;
                 flex-direction: column;
             }
     
             .header {
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 background-color: #e0e0e0;
                 padding-top: 10px;
                 padding-bottom: 10px;
                 border-bottom: 2px solid #ccc;
                 z-index: 1;
                 position: relative;
             }
     
             .header .logo {
                 width: 50px;
                 height: auto;
                 margin-left: 100px;
                 transition: margin-left 0.5s ease;
             }
     
             .header .logo.csd {
                 margin-left: 20px;
             }
     
             .header .title {
                 font-size: 28px;
                 font-weight: bold;
                 color: #333;
                 text-align: center;
                 flex-grow: 1;
             }
     
             .content {
                 flex-grow: 1;
                 background-color: #d50000;
                 padding: 40px;
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 transition: margin-left 0.5s ease;
             }
     
             .filter-container {
                 margin-bottom: 20px;
             }
     
             .filter-container select {
                 padding: 10px;
                 font-size: 16px;
             }
     
             #reportTable {
                 width: 100%;
                 border-collapse: collapse;
             }
     
             #reportTable th, #reportTable td {
                 padding: 10px;
                 border: 1px solid #000;
             }
     
             .modal {
         display: none;
         justify-content: center;
         align-items: flex-start;
         position: fixed;
         z-index: 2;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         padding-top: 50px;
     }
     
     .modal-content {
         background-color: #fefefe;
         margin: 2% auto;
         padding: 20px;
         border: 1px solid #888;
         width: 30%; /* Adjust the width to make it smaller */
         border-radius: 10px;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
     }
     
     
     .close {
         color: #aaa;
         float: right;
         font-size: 28px;
         font-weight: bold;
     }
     
     .close:hover,
     .close:focus {
         color: #000;
         text-decoration: none;
         cursor: pointer;
     }
     
     /* start modal */
.container {
    background: #f44336; /* Solid red color matching the delete icon */
    padding: 15px;
    width: 100%;
    border-radius: 10px;
    color: #ffffff; /* White text for readability */
    display: flex;
    justify-content: space-between;
    align-items: center; /* Align content vertically */
    box-sizing: border-box;
    transition: background 0.3s ease; /* Smooth transition for hover effect */
}

.container:hover {
    background: #e53935; /* Slightly darker red for hover */
}
/* end */
     
     .form-container {
         width: 100%; /* Adjust the width to allow more space for form fields */
     }
     .form-container form {
         display: flex;
         flex-direction: column;
         gap: 10px;
     }
     
     .form-container form label {
         font-size: 14px;
         margin-bottom: 5px;
     }
     
     .form-container form select,
     .form-container form input {
         width: 100%; /* This makes the input/select fill the entire available width */
         padding: 8px;
         border: 1px solid #ccc;
         border-radius: 5px;
         background-color: #f9f9f9;
         color: #333;
         font-size: 14px;
     }
     
             #yearFilter, #quarterFilter, #monthFilter {
             margin: 10px 0; /* Adds top and bottom margin */
              }
     
             body {
                 font-family: 'Roboto', sans-serif;
                 height: 100vh;
                 display: flex;
                 flex-direction: column;
             }
     
             .header {
                 display: flex;
                 justify-content: space-between;
                 align-items: center;
                 background-color: #e0e0e0;
                 padding-top: 10px;
                 padding-bottom: 10px;
                 border-bottom: 2px solid #ccc;
                 z-index: 1;
                 position: relative;
             }
     
             .header .logo {
                 width: 50px;
                 height: auto;
                 margin-left: 100px;
                 transition: margin-left 0.5s ease;
             }
     
             .header .logo.csd {
                 margin-left: 20px;
             }
     
             .header .title {
                 font-size: 28px;
                 font-weight: bold;
                 color: #333;
                 text-align: center;
                 flex-grow: 1;
             }
     
             .content {
                 flex-grow: 1;
                 background-color: #d50000;
                 padding: 40px;
                 display: flex;
                 justify-content: center;
                 align-items: center;
                 transition: margin-left 0.5s ease;
             }
     
             .filter-container {
                 margin-bottom: 20px;
             }
     
             .filter-container select {
                 padding: 10px;
                 font-size: 16px;
             }
     
             #reportTable {
                 width: 100%;
                 border-collapse: collapse;
             }
     
             #reportTable th, #reportTable td {
                 padding: 10px;
                 border: 1px solid #000;
             }
             .modal {
         display: none;
         justify-content: center;
         align-items: flex-start;
         position: fixed;
         z-index: 2;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         padding-top: 50px;
     }
     
     .modal-content {
         background-color: #fefefe;
         margin: 2% auto;
         padding: 20px;
         border: 1px solid #888;
         width: 30%; /* Adjusted width for a narrower modal on larger screens */
         max-width: 400px; /* Maximum width to prevent excessive stretching */
         border-radius: 10px;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
     }
     
     .close {
         color: #aaa;
         float: right;
         font-size: 28px;
         font-weight: bold;
     }
     
     .close:hover,
     .close:focus {
         color: #000;
         text-decoration: none;
         cursor: pointer;
     }
     
     .container {
         background-color: #d50000;
         padding: 15px;
         width: 100%;
         border-radius: 10px;
         color: #fff;
         display: flex;
         justify-content: space-between;
         box-sizing: border-box;
     }
     
     .form-container {
         width: 100%;
     }
     
     .form-container form {
         display: flex;
         flex-direction: column;
         gap: 10px;
     }
     
     .form-container form label {
         font-size: 14px;
         margin-bottom: 5px;
     }
     
     .form-container form select,
     .form-container form input {
         width: 100%;
         padding: 8px;
         border: 1px solid #ccc;
         border-radius: 5px;
         background-color: #f9f9f9;
         color: #333;
         font-size: 14px;
     }
     
     .buttons-container {
         display: flex;
         justify-content: center;
         gap: 10px;
         margin-top: 20px;
     }
     
     button {
         padding: 10px 15px;
         font-size: 14px;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         transition: background-color 0.3s ease;
     }
     
    /* start button */
button.btn-primary {
    background-color: #f44336; /* Matching red background color */
    color: #fff; /* White text for readability */
    border: none; /* Remove default border */
    padding: 10px 20px; /* Adjust padding for a better button appearance */
    border-radius: 5px; /* Rounded corners */
    font-size: 16px; /* Font size for the button */
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

button.btn-primary:hover {
    background-color: #e53935; /* Slightly darker red for hover effect */
}
/* end*/
     
     button.btn-secondary {
         background-color: #666;
         color: white;
     }
     
     button.btn-secondary:hover {
         background-color: #555;
     }
     
     button.btn-danger {
         background-color: #ffffff;
         color: rgb(0, 0, 0);
     }
     
     button.btn-danger:hover {
         background-color: #d50000;
     }
     
     .pagination-container {
              margin-top: 20px; /* Add some margin above the pagination */
              text-align: center;
          }
          
          .pagination .page-item .page-link {
              color: black; /* Set font color to black */
          }
          
          .pagination .page-item.active .page-link {
              background-color: #f44336; /* Active page with the same red color */
              border-color: #f44336;
              color: white; /* White text for the active page */
          }
          
          .pagination .page-link:hover {
              background-color: #f44336; /* Darker red on hover */
              color: white; /* White text on hover */
          }
     
     .delete-icon {
         cursor: pointer;
         color: #fd0808;
     }
     
     @media screen and (max-width: 768px) {
         .modal-content {
             width: 90%; /* Full width for smaller screens */
         }
     
         .form-container,
         .result-container {
             width: 100%;
         }
     
         .container {
             padding: 10px;
         }
     }
         </style>
</head>
<body>
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="{{ url_for('emu_dashboard') }}">EMU <span style="text-transform: uppercase; font-style: italic;">{{ session['campus']}} CAMPUS</span></a>
        <!-- Spacer to push "Sign-out" to the right -->
        <div class="ms-auto"></div>
    
        <!-- Sign-out Icon and Link -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-power-off fa-fw"></i> Sign-out
                </a>
            </li>
        </ul>
    </nav>

    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{{ url_for('emu_dashboard') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                        <div class="sb-sidenav-menu-heading">Consumption Report</div>
                        <nav class="sb-sidenav-menu-nested nav">
                            <a class="nav-link" href="{{ url_for('electricity_consumption') }}">Electricity</a>
                            <a class="nav-link" href="{{ url_for('emu_fuel') }}">Fuel</a>
                            <a class="nav-link" href="{{ url_for('water_consumption') }}">Water Consumption</a>
                            <a class="nav-link" href="{{ url_for('treated_water') }}">Treated Water</a>
                            <a class="nav-link" href="{{ url_for('waste_segregation') }}">Waste Segregation</a>
                            <a class="nav-link" href="{{ url_for('waste_unsegregation') }}">Waste Unsegregation</a>
                            </nav>
                    </div>
                </div>
            </nav>
        </div>

        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <h1 class="mt-4">Waste Segregation</h1>
                    <ol class="breadcrumb mb-4">
                        <li class="breadcrumb-item"><a href="{{ url_for('emu_dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item active">Waste Segregation</li>
                    </ol>

                    <div class="card mb-4">
                        <div class="card-body">
                            Waste segregation refers to the systematic separation of different types of waste materials at the point of disposal into categories such as biodegradable, recyclable, and non-recyclable waste. This practice is a crucial element in effective waste management and sustainability efforts.
                        </div>
                    </div>

                    <div id="WasteSection" class="d-flex justify-content-start gap-2 mt-3">
                        <button id="openModalBtn" class="btn btn-primary" onclick="openCalculatorModal()">Calculate</button>
                        <button class="btn btn-primary" onclick="printReport()">Print Report</button>
                        <button class="btn btn-primary" onclick="downloadExcel()">Download Excel</button>
                        <button class="btn btn-primary" onclick="downloadCSV()">Download CSV</button>
                    </div>
                    
                    
                    
                  <!-- Filter section -->
<div class="mb-4">
    <label for="monthFilter">Filter by Month:</label>
    <select id="monthFilter" onchange="applyFilter()">
        <option value="">All Months</option>
        <option value="January" {% if selected_month == 'January' %}selected{% endif %}>January</option>
        <option value="February" {% if selected_month == 'February' %}selected{% endif %}>February</option>
        <option value="March" {% if selected_month == 'March' %}selected{% endif %}>March</option>
        <option value="April" {% if selected_month == 'April' %}selected{% endif %}>April</option>
        <option value="May" {% if selected_month == 'May' %}selected{% endif %}>May</option>
        <option value="June" {% if selected_month == 'June' %}selected{% endif %}>June</option>
        <option value="July" {% if selected_month == 'July' %}selected{% endif %}>July</option>
        <option value="August" {% if selected_month == 'August' %}selected{% endif %}>August</option>
        <option value="September" {% if selected_month == 'September' %}selected{% endif %}>September</option>
        <option value="October" {% if selected_month == 'October' %}selected{% endif %}>October</option>
        <option value="November" {% if selected_month == 'November' %}selected{% endif %}>November</option>
        <option value="December" {% if selected_month == 'December' %}selected{% endif %}>December</option>
    </select>

    <label for="quarterFilter">Filter by Quarter:</label>
    <select id="quarterFilter" onchange="applyFilter()">
        <option value="">All Quarters</option>
        <option value="Q1" {% if selected_quarter == 'Q1' %}selected{% endif %}>Q1</option>
        <option value="Q2" {% if selected_quarter == 'Q2' %}selected{% endif %}>Q2</option>
        <option value="Q3" {% if selected_quarter == 'Q3' %}selected{% endif %}>Q3</option>
        <option value="Q4" {% if selected_quarter == 'Q4' %}selected{% endif %}>Q4</option>
    </select>

    <label for="yearFilter">Filter by Year:</label>
    <select id="yearFilter" onchange="applyFilter()">
        <option value="">All Years</option>
        <option value="2014" {% if selected_year == "2014" %}selected{% endif %}>2014</option>
        <option value="2015" {% if selected_year == "2015" %}selected{% endif %}>2015</option>
        <option value="2016" {% if selected_year == "2016" %}selected{% endif %}>2016</option>
        <option value="2017" {% if selected_year == "2017" %}selected{% endif %}>2017</option>
        <option value="2018" {% if selected_year == "2018" %}selected{% endif %}>2018</option>
        <option value="2019" {% if selected_year == "2019" %}selected{% endif %}>2014</option>
        <option value="2020" {% if selected_year == "2020" %}selected{% endif %}>2020</option>
        <option value="2021" {% if selected_year == "2021" %}selected{% endif %}>2021</option>
        <option value="2022" {% if selected_year == "2022" %}selected{% endif %}>2022</option>
        <option value="2023" {% if selected_year == "2023" %}selected{% endif %}>2023</option>
        <option value="2024" {% if selected_year == "2024" %}selected{% endif %}>2024</option>
    </select>
</div>


                    <!-- Modal for Adding Records -->
                    <div class="modal" id="myModal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="container">
                                <div class="form-container">
                                    <form id="wasteForm" method="POST" action="{{ url_for('waste_segregation') }}">
                                        <label for="campus">Campus:</label>
                                        <select id="campus" name="campus" disabled>
                                            <option value="" {% if not session.get('campus') %}selected{% endif %}></option>
                                            <option value="Alangilan" {% if session.get('campus') == 'Alangilan' %}selected{% endif %}>Alangilan</option>
                                            <option value="ARASOF-Nasugbu" {% if session.get('campus') == 'ARASOF-Nasugbu' %}selected{% endif %}>ARASOF-Nasugbu</option>
                                            <option value="Balayan" {% if session.get('campus') == 'Balayan' %}selected{% endif %}>Balayan</option>
                                            <option value="Central" {% if session.get('campus') == 'Central' %}selected{% endif %}>Central</option>
                                            <option value="JPLPC-Malvar" {% if session.get('campus') == 'JPLPC-Malvar' %}selected{% endif %}>JPLPC-Malvar</option>
                                            <option value="Lemery" {% if session.get('campus') == 'Lemery' %}selected{% endif %}>Lemery</option>
                                            <option value="Lipa" {% if session.get('campus') == 'Lipa' %}selected{% endif %}>Lipa</option>
                                            <option value="Lobo" {% if session.get('campus') == 'Lobo' %}selected{% endif %}>Lobo</option>
                                            <option value="Mabini" {% if session.get('campus') == 'Mabini' %}selected{% endif %}>Mabini</option>
                                            <option value="Pablo Borbon" {% if session.get('campus') == 'Pablo Borbon' %}selected{% endif %}>Pablo Borbon</option>
                                            <option value="Rosario" {% if session.get('campus') == 'Rosario' %}selected{% endif %}>Rosario</option>
                                            <option value="San Juan" {% if session.get('campus') == 'San Juan' %}selected{% endif %}>San Juan</option>
                                        </select>

                                        <label for="year">Year:</label>
                                        <select id="year" name="year" required>
                                            <option value=""></option>
                                            <option value="2020">2020</option>
                                            <option value="2021">2021</option>
                                            <option value="2022">2022</option>
                                            <option value="2023">2023</option>
                                            <option value="2024">2024</option>
                                        </select>

                                        <label for="month">Month:</label>
                                        <select id="month" name="month" required onchange="updateQuarter()">
                                            <option value=""></option>
                                            <option value="January">January</option>
                                            <option value="February">February</option>
                                            <option value="March">March</option>
                                            <option value="April">April</option>
                                            <option value="May">May</option>
                                            <option value="June">June</option>
                                            <option value="July">July</option>
                                            <option value="August">August</option>
                                            <option value="September">September</option>
                                            <option value="October">October</option>
                                            <option value="November">November</option>
                                            <option value="December">December</option>
                                        </select>

                                        <label for="quarter">Quarter:</label>
<input type="text" id="quarter" name="quarter" readonly style="background: #f9f9f9; border: 1px solid #ccc; padding: 5px; width: 320px;" value="">

                                        <label for="mainCategory">Main Category:</label>
                                            <select id="mainCategory" name="mainCategory" required>
                                                <option value=""></option>
                                                <option value="Biodegradable">Biodegradable</option>
                                                <option value="Recyclable">Recyclable</option>
                                                <option value="Residual">Residual</option>
                                                <option value="Special">Special Waste</option>
                                            </select>

                                            <label for="subCategory">Subcategory:</label>
                                            <select id="subCategory" name="subCategory" required>
                                                <option value=""></option>
                                                <!-- Subcategories will be dynamically populated -->
                                            </select>

                                        <label for="quantity">Quantity (in kg):</label>
                                        <input type="number" id="quantity" name="quantity" step="0.01" required>

                                        <button type="submit" id="calculateBtn" style="background-color: #666; color: white;">Calculate</button>

                                        <!-- GHG Emission fields -->
                                        <div style="margin: 20px; font-family: Arial, sans-serif; max-width: 400px; background: #f9f9f9; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                            <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                                                <label for="ghgEmissionKg" style="font-weight: bold; color: #333; margin-right: 10px;">GHG Emission (kg CO₂-e):</label>
                                                <input type="number" id="ghgEmissionKg" name="ghgEmissionKg" step="0.01" readonly 
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;" value="0.00">
                                            </div>
                                            <div style="margin-bottom: 0; display: flex; justify-content: space-between; align-items: center;">
                                                <label for="ghgEmissionT" style="font-weight: bold; color: #333; margin-right: 10px;">GHG Emission (t CO₂-e):</label>
                                                <input type="number" id="ghgEmissionT" name="ghgEmissionT" step="0.0001" readonly 
                                                    style="border: none; background: transparent; color: #555; text-align: right; width: 100px;" value="0.0000">
                                            </div>
                                        </div>

                                        <!-- Calculate and Generate Report Buttons -->
                                        <button type="submit" style="background-color: #666; color: white;">Generate Report</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                

                    <div class="table-responsive mt-4">
                        <div class="table-wrapper">
                        <table id="reportTable">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th>Quarter</th>
                                    <th>Main Category</th>
                                    <th>Subcategory</th>
                                    <th>Quantity (kg)</th>
                                    <th>GHG Emission (kg CO₂-e)</th>
                                    <th>GHG Emission (t CO₂-e)</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reportData">
                                {% for report in reports %}
                                <tr>
                                    <td>{{ report.Year }}</td>
                                    <td>{{ report.Month }}</td>
                                    <td>{{ report.Quarter }}</td>
                                    <td>{{ report['MainCategory'] }}</td>
                                    <td>{{ report.SubCategory }}</td>
                                    <td>{{ report.QuantityInKG }}</td>
                                    <td>{{ report.GHGEmissionKGCO2e }}</td>
                                    <td>{{ report.GHGEmissionTCO2e }}</td>
                                    <td>
                                        <button class="delete-btn" onclick="deleteRow({{ report.id }})"><i class="fa-solid fa-trash"></i></button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    </div>

                    <!-- Pagination controls -->
                    <!-- Pagination controls -->
<div class="pagination-container">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            {% if total_pages > 1 %}
                <!-- Previous button -->
                <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('waste_segregation', page=current_page - 1) }}" tabindex="-1">Previous</a>
                </li>
                
                <!-- Page numbers -->
                <span>Page {{ current_page }} of {{ total_pages }}</span>
                
                <!-- Next button -->
                <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('waste_segregation', page=current_page + 1) }}">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

                    

                </div>
            </main>

            
        </div>
    </div>

    <script>
        // Open and close the modal
        function openCalculatorModal() {
            const modal = document.getElementById('myModal');
            modal.style.display = 'block'; // Show the modal
        }
    
        function closeModal() {
            const modal = document.getElementById('myModal');
            modal.style.display = 'none'; // Hide the modal
        }
    
        // Function to calculate GHG emissions and update fields
        function calculateEmissions() {
            // Get values from form inputs
            const quantity = parseFloat(document.getElementById('quantity').value);
            const mainCategory = document.getElementById('mainCategory').value.toLowerCase();
            const subCategory = document.getElementById('subCategory').value;
    
            // Define emission factors
            const emissionFactors = {
                biodegradable: {
                    "Garden Waste": 0.57896,
                    "Food Waste": 0.62687,
                    "Mixed Food & Garden Waste": 0.58734
                },
                recyclable: {
                    "Mixed Plastic": 0.00890,
                    "Mixed Metal": 0.00890,
                    "Mixed Paper": 1.04180,
                    "Mixed Glass": 0.00890
                },
                residual: {
                    "Residual Waste": 0.44624
                },
                special: {
                    "Special Waste": 0.00890
                }
            };
    
            // Check if the selected category and subcategory have a defined emission factor
            const emissionFactor = (emissionFactors[mainCategory] || {})[subCategory];
            if (emissionFactor === undefined) {
                alert("Invalid category or subcategory. Please select valid options.");
                return;
            }
    
            // Calculate GHG Emissions
            const ghgEmissionKg = quantity * emissionFactor; // in kg CO₂-e
            const ghgEmissionT = ghgEmissionKg / 1000; // convert kg to metric tons
    
            // Display calculated values in the form fields
            document.getElementById('ghgEmissionKg').value = ghgEmissionKg.toFixed(2); // Rounded to 2 decimal places
            document.getElementById('ghgEmissionT').value = ghgEmissionT.toFixed(6); // More precision for tons
        }
    
        // Event listener for Calculate button
        document.getElementById('calculateBtn').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent form submission
            calculateEmissions(); // Perform the calculation without closing the modal
        });
    
        // Handle form submission for Generate Report button
        document.getElementById('wasteForm').addEventListener('submit', function (e) {
            e.preventDefault();  // Prevent default form submission to manually handle it
            const form = this;
    
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => {
                if (response.ok) {
                    closeModal();  // Close the modal only when "Generate Report" is clicked
                    location.reload();  // Reload the page to show the updated table
                }
            })
            .catch(error => console.error('Form submit error:', error));
        });
        
        // Define categories for subcategory selection
        const categories = {
            biodegradable: [
                { value: "Garden Waste", label: "Garden Waste" },
                { value: "Food Waste", label: "Food Waste" },
                { value: "Mixed Food & Garden Waste", label: "Mixed Food & Garden Waste" }
            ],
            recyclable: [
                { value: "Mixed Plastic", label: "Mixed Plastic" },
                { value: "Mixed Metal", label: "Mixed Metal" },
                { value: "Mixed Paper", label: "Mixed Paper" },
                { value: "Mixed Glass", label: "Mixed Glass" }
            ],
            residual: [
                { value: "Residual Waste", label: "Residual Waste" }
            ],
            special: [
                { value: "Special Waste", label: "Special Waste" }
            ]
        };
    
        // Function to populate subcategories based on the selected main category
        document.getElementById('mainCategory').addEventListener('change', function(event) {
            const mainCategoryValue = event.target.value.toLowerCase(); // Convert selection to lowercase
            const subCategorySelect = document.getElementById('subCategory');
            
            // Clear any existing options
            subCategorySelect.innerHTML = '<option value="">Select a subcategory</option>';
    
            // Get the relevant subcategories from the categories object
            const selectedSubcategories = categories[mainCategoryValue] || [];
    
            // Populate the subcategory dropdown
            selectedSubcategories.forEach(subCat => {
                const option = document.createElement('option');
                option.value = subCat.value;
                option.textContent = subCat.label;
                subCategorySelect.appendChild(option);
            });
        });
    
        // Pagination and filter functionality
        let currentPage = 1;
        const rowsPerPage = 20;
    
        function renderTable() {
            const rows = document.querySelectorAll('#reportData tr');
            const totalRows = rows.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
    
            rows.forEach((row, index) => {
                if (index >= startIndex && index < endIndex) {
                    row.style.display = ''; // Show the row
                } else {
                    row.style.display = 'none'; // Hide the row
                }
            });
        }
    
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }
    
        function nextPage() {
            const totalRows = document.querySelectorAll('#reportData tr').length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        }
    
        function applyFilter() {
    // Get the filter values
    const month = document.getElementById('monthFilter').value;
    const quarter = document.getElementById('quarterFilter').value;
    const year = document.getElementById('yearFilter').value;

    // Build the query string
    let queryString = '';
    if (month) queryString += `month=${encodeURIComponent(month)}&`;
    if (quarter) queryString += `quarter=${encodeURIComponent(quarter)}&`;
    if (year) queryString += `year=${encodeURIComponent(year)}`;

    // Remove trailing "&" if any, and redirect to filtered page
    queryString = queryString ? '?' + queryString.slice(0, -1) : '';
    window.location.href = `/waste_segregation${queryString}`;
}


    
function deleteRow(id) {
    if (!confirm("Are you sure you want to delete this record?")) return;

    fetch(`/delete_waste_record/${id}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload(); // Reload the page to update the table after deletion
        } else {
            alert("Error deleting record: " + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert("An error occurred while deleting the record.");
    });
}

    
function printReport() {
    // Get filter values
    const month = document.getElementById('monthFilter').value;
    const quarter = document.getElementById('quarterFilter').value;
    const year = document.getElementById('yearFilter').value;

    // Build the query string for the fetch URL
    let queryString = '';
    if (month) queryString += `month=${encodeURIComponent(month)}&`;
    if (quarter) queryString += `quarter=${encodeURIComponent(quarter)}&`;
    if (year) queryString += `year=${encodeURIComponent(year)}`;

    // Determine fetch URL
    const fetchUrl = queryString ? `/waste_segregation/all?${queryString}` : `/waste_segregation/all`;

    // Fetch data and build print content
    fetch(fetchUrl)
        .then(response => response.json())
        .then(data => {
            if (!data.length) {
                alert("No data available to print for the selected filters.");
                return;
            }

            const tableHeader = `
                <thead>
                    <tr>
                        <th>Campus</th>
                        <th>Year</th>
                        <th>Quarter</th>
                        <th>Month</th>
                        <th>Main Category</th>
                        <th>Subcategory</th>
                        <th>Quantity (kg)</th>
                        <th>GHG Emission (kg CO₂-e)</th>
                        <th>GHG Emission (t CO₂-e)</th>
                    </tr>
                </thead>`;

            const tableBody = data.map(report => `
                <tr>
                    <td>${report.Campus}</td>
                    <td>${report.Year}</td>
                    <td>${report.Quarter}</td>
                    <td>${report.Month}</td>
                    <td>${report.MainCategory}</td>
                    <td>${report.SubCategory}</td>
                    <td>${report.QuantityInKG}</td>
                    <td>${report.GHGEmissionKGCO2e}</td>
                    <td>${report.GHGEmissionTCO2e}</td>
                </tr>
            `).join('');

            const printContents = `
                <div class="header">
                    <img src="${window.location.origin}/static/images/bsu.png" alt="BSU Logo" style="width: 50px; height: auto;">
                    <h2>Waste Segregation Report</h2>
                    <img src="${window.location.origin}/static/images/csd.png" alt="CSD Logo" style="width: 50px; height: auto;">
                </div>
                <table border="1" cellspacing="0" cellpadding="5">
                    ${tableHeader}
                    <tbody>${tableBody}</tbody>
                </table>`;

            // Print the report
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        })
        .catch(error => console.error('Error fetching data:', error));
}

function downloadExcel() {
    const month = document.getElementById('monthFilter').value;
    const quarter = document.getElementById('quarterFilter').value;
    const year = document.getElementById('yearFilter').value;

    let queryString = '';
    if (month) queryString += `month=${encodeURIComponent(month)}&`;
    if (quarter) queryString += `quarter=${encodeURIComponent(quarter)}&`;
    if (year) queryString += `year=${encodeURIComponent(year)}`;
    queryString = queryString ? '?' + queryString : '';

    fetch(`/waste_segregation/all${queryString}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (!data || data.length === 0) {
                alert('No data available for export.');
                return;
            }

            try {
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Waste Segregation Data');

                XLSX.utils.sheet_add_aoa(worksheet, [[
                    'Campus', 'Year', 'Quarter', 'Month', 'Main Category',
                    'Subcategory', 'Quantity (kg)', 'GHG Emission (kg CO₂-e)', 'GHG Emission (t CO₂-e)'
                ]], { origin: 'A1' });

                XLSX.writeFile(workbook, 'WasteSegregationReport.xlsx');
            } catch (exportError) {
                console.error('Error exporting data:', exportError);
                alert('An error occurred while processing the data export.');
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            alert('An error occurred while exporting the data. Please try again.');
        });
}
    </script>
<script>
    function updateQuarter() {
        const month = document.getElementById('month').value;
        const quarterDropdown = document.getElementById('quarter');

        let quarter = "";
        if (["January", "February", "March"].includes(month)) {
            quarter = "Q1";
        } else if (["April", "May", "June"].includes(month)) {
            quarter = "Q2";
        } else if (["July", "August", "September"].includes(month)) {
            quarter = "Q3";
        } else if (["October", "November", "December"].includes(month)) {
            quarter = "Q4";
        }

        // Set the quarter dropdown value
        quarterDropdown.value = quarter;
    }

    function downloadCSV() {
    const month = document.getElementById('monthFilter').value;
    const quarter = document.getElementById('quarterFilter').value;
    const year = document.getElementById('yearFilter').value;

    let queryString = '';
    if (month) queryString += `month=${encodeURIComponent(month)}&`;
    if (quarter) queryString += `quarter=${encodeURIComponent(quarter)}&`;
    if (year) queryString += `year=${encodeURIComponent(year)}`;
    queryString = queryString ? '?' + queryString : '';

    fetch(`/waste_segregation/all${queryString}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (!data || data.length === 0) {
                alert('No data available for export.');
                return;
            }

            // Generate CSV content
            const headers = [
                'Campus', 'Year', 'Quarter', 'Month', 'Main Category',
                'Subcategory', 'Quantity (kg)', 'GHG Emission (kg CO₂-e)', 'GHG Emission (t CO₂-e)'
            ];
            const rows = data.map(report => [
                report.Campus, report.Year, report.Quarter, report.Month, 
                report.MainCategory, report.SubCategory, report.QuantityInKG,
                report.GHGEmissionKGCO2e, report.GHGEmissionTCO2e
            ]);

            const csvContent = [headers, ...rows]
                .map(row => row.map(value => `"${value}"`).join(','))
                .join('\n');

            // Trigger CSV download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', 'WasteSegregationReport.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        })
        .catch(error => {
            console.error('Error exporting CSV:', error);
            alert('An error occurred while exporting the data to CSV.');
        });
}

</script>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
